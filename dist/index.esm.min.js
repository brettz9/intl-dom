function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h,v=(function(e,t){const r=-1,n=0,i=1,a=2,o=3,s=4,u=5,c=6,l=7,f=8,p=9,h=10,v=11,g=13,y=0,b=[];function d(){var e=b.pop();return e||(e={context:y,elements:null,element_array:null}),e}function m(e){b.push(e)}const w=[];function k(e){w.push(e)}var F=t;F.escape=function(e){var t,r="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(r+="\\"),r+=e[t];return r},F.begin=function(e,t){const b={name:null,value_type:n,string:"",contains:null},F={line:1,col:1};let j,x=0;var D=0,S=!0,E=!1,O=null,_=void 0,P=[],A={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},pop(){var e=this.last;return e?((this.last=e.prior)||(this.first=null),e.next=this.saved,this.saved=e,e.node):null}},T=y,N=0,M=!1,C=!1,L=!1,R=!1,I=!1,B={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=this.first,t.prior=null):t={node:e,next:this.first,prior:null},this.first||(this.last=t),this.first=t}},K=null,$=!1,U=!1,q=!1,V=!1,z=!1,W=!1,J=!1,Z=0,G=0,H=!1,Q=!1;return{value(){var e=O;return O=void 0,e},reset(){D=0,S=!0,B.last&&(B.last.next=B.save),B.save=B.first,B.first=B.last=null,A.last&&(A.last.next=A.save),A.save=B.first,A.first=A.last=null,P=null,_=void 0,T=y,b.value_type=n,b.name=null,b.string="",F.line=1,F.col=1,E=!1,N=0,Q=!1,$=!1,q=!1,V=!1},write(r){var n;for("string"!=typeof r&&(r=String(r)),n=this._write(r,!1);n>0&&(O&&("function"==typeof t&&function e(r,n){var i,a,o=r[n];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(a=e(o,i))?o[i]=a:delete o[i]);return t.call(r,n,o)}({"":O},""),e(O),O=void 0),!(n<2));n=this._write());},_write(e,t){var X,Y,ee,te=0;function re(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${x} (near '${ee.substr(x>4?x-4:0,x>4?3:x-1)}[${String.fromCodePoint(t)}]${ee.substr(x,10)}') [${F.line}:${F.col}]`)}function ne(){b.value_type=n,b.string=""}function ie(e){return e.length>1&&!M&&!C&&!L&&48===e.charCodeAt(0)?(E?-1:1)*Number("0o"+e):(E?-1:1)*Number(e)}function ae(){switch(b.value_type){case u:P.push(ie(b.string));break;case s:P.push(b.string);break;case a:P.push(!0);break;case o:P.push(!1);break;case f:case p:P.push(NaN);break;case h:P.push(-1/0);break;case v:P.push(1/0);break;case i:P.push(null);break;case r:P.push(void 0);break;case g:P.push(void 0),delete P[P.length-1];break;case c:case l:P.push(b.contains);break;default:console.log("Unhandled array push.")}}function oe(){switch(b.value_type){case u:_[b.name]=ie(b.string);break;case s:_[b.name]=b.string;break;case a:_[b.name]=!0;break;case o:_[b.name]=!1;break;case f:case p:_[b.name]=NaN;break;case h:_[b.name]=-1/0;break;case v:_[b.name]=1/0;break;case i:_[b.name]=null;break;case r:_[b.name]=void 0;break;case c:case l:_[b.name]=b.contains}}function se(e){let t=0;for(;0==t&&x<ee.length;){j=ee.charAt(x);let r=ee.codePointAt(x++);if(r>=65536&&(j+=ee.charAt(x),x++),F.col++,r==e)q?(b.string+=j,q=!1):(t=-1,H?re("Incomplete Octal sequence",r):J?re("Incomplete hexidecimal sequence",r):W?re("Incomplete unicode sequence",r):z&&re("Incomplete long unicode sequence",r),t=1);else if(q){if(H){if(G<3&&r>=48&&r<=57){if(Z*=8,Z+=r-48,3==++G){b.string+=String.fromCodePoint(Z),H=!1,q=!1;continue}continue}if(Z>255){re("(escaped character, parsing octal escape val=%d) fault while parsing",r),t=-1;break}b.string+=String.fromCodePoint(Z),H=!1,q=!1;continue}if(z){if(125==r){b.string+=String.fromCodePoint(Z),z=!1,W=!1,q=!1;continue}if(Z*=16,r>=48&&r<=57)Z+=r-48;else if(r>=65&&r<=70)Z+=r-65+10;else{if(!(r>=97&&r<=102)){re("(escaped character, parsing hex of \\u)",r),t=-1,z=!1,q=!1;continue}Z+=r-97+10}continue}if(J||W){if(0===G&&123===r){z=!0;continue}if(G<2||W&&G<4){if(Z*=16,r>=48&&r<=57)Z+=r-48;else if(r>=65&&r<=70)Z+=r-65+10;else{if(!(r>=97&&r<=102)){re(W?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",r),t=-1,J=!1,q=!1;continue}Z+=r-97+10}G++,W?4==G&&(b.string+=String.fromCodePoint(Z),W=!1,q=!1):2==G&&(b.string+=String.fromCodePoint(Z),J=!1,q=!1);continue}}switch(r){case 13:V=!0,F.col=1;continue;case 10:case 2028:case 2029:F.line++;break;case 116:b.string+="\t";break;case 98:b.string+="\b";break;case 110:b.string+="\n";break;case 114:b.string+="\r";break;case 102:b.string+="\f";break;case 48:case 49:case 50:case 51:H=!0,Z=r-48,G=1;continue;case 120:J=!0,G=0,Z=0;continue;case 117:W=!0,G=0,Z=0;continue;default:b.string+=j}q=!1}else if(92===r)q?(b.string+="\\",q=!1):q=!0;else{if(V){if(V=!1,10==r){F.line++,F.col=1,q=!1;continue}F.line++,F.col=1;continue}b.string+=j}}return t}function ue(){let e;for(;(e=x)<ee.length;){j=ee.charAt(e);let r=ee.codePointAt(x++);if(r>=65536&&(re("fault while parsing number;",r),j+=ee.charAt(x),x++),95!=r)if(F.col++,r>=48&&r<=57)L&&(I=!0),b.string+=j;else if(45==r||43==r){if(0!=b.string.length&&(!L||R||I)){S=!1,re("fault while parsing number;",r);break}b.string+=j,R=!0}else if(46==r){if(C||M||L){S=!1,re("fault while parsing number;",r);break}b.string+=j,C=!0}else if(120==r||98==r||111==r||88==r||66==r||79==r){if(M||"0"!=b.string){S=!1,re("fault while parsing number;",r);break}M=!0,b.string+=j}else{if(101!=r&&69!=r){if(32==r||13==r||10==r||9==r||65279==r||44==r||125==r||93==r||58==r)break;t&&(S=!1,re("fault while parsing number;",r));break}if(L){S=!1,re("fault while parsing number;",r);break}b.string+=j,L=!0}}x=e,t||x!=ee.length?(U=!1,b.value_type=u,T==y&&(Q=!0)):U=!0}if(!S)return-1;for(e&&e.length?((Y=function(){var e=w.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=e,B.push(Y)):U&&(U=!1,b.value_type=u,T==y&&(Q=!0),te=1);S&&(Y=B.shift());){if(x=Y.n,ee=Y.buf,$){let e=se(K);e<0?S=!1:e>0&&($=!1,S&&(b.value_type=s))}for(U&&ue();!Q&&S&&x<ee.length;){if(j=ee.charAt(x),(X=ee.codePointAt(x++))>=65536&&(j+=ee.charAt(x),x++),F.col++,N){if(1==N){if(42==X){N=3;continue}47!=X?(re("fault while parsing;",X),S=!1):N=2;continue}if(2==N){if(10==X){N=0;continue}continue}if(3==N){if(42==X){N=4;continue}continue}if(4==N){if(47==X){N=0;continue}42!=X&&(N=3);continue}}switch(X){case 47:N||(N=1);break;case 123:if(29==D||30==D||3==T&&0==D){re("fault while parsing; getting field name unexpected ",X),S=!1;break}{let e=d();b.value_type=c;let t={};T==y?O=_=t:4==T&&(_[b.name]=t),e.context=T,e.elements=_,e.element_array=P,e.name=b.name,_=t,A.push(e),ne(),T=3}break;case 91:if(3==T||29==D||30==D){re("Fault while parsing; while getting field name unexpected",X),S=!1;break}{let e=d();b.value_type=l;let t=[];T==y?O=P=t:4==T&&(_[b.name]=t),e.context=T,e.elements=_,e.element_array=P,e.name=b.name,P=t,A.push(e),ne(),T=1}break;case 58:if(3==T){if(0!=D&&29!=D&&30!=D){S=FALSE,thorwError(`fault while parsing; unquoted keyword used as object field name (state:${D})`,X);break}D=0,b.name=b.string,b.string="",T=4,b.value_type=n}else re(1==T?"(in array, got colon out of string):parsing fault;":"(outside any object, got colon out of string):parsing fault;",X),S=!1;break;case 125:if(31==D&&(D=0),3==T){ne();let e=A.pop();T=e.context,_=e.elements,P=e.element_array,m(e),T==y&&(Q=!0)}else if(4==T){b.value_type!=n&&oe(),b.value_type=c,b.contains=_;var ce=A.pop();b.name=ce.name,T=ce.context,_=ce.elements,P=ce.element_array,m(ce),T==y&&(Q=!0)}else re("Fault while parsing; unexpected",X),S=!1;E=!1;break;case 93:31==D&&(D=0),1==T?(b.value_type!=n&&ae(),b.value_type=l,b.contains=P,ce=A.pop(),b.name=ce.name,T=ce.context,_=ce.elements,P=ce.element_array,m(ce),T==y&&(Q=!0)):(re(`bad context ${T}; fault while parsing`,X),S=!1),E=!1;break;case 44:31==D&&(D=0),1==T?(b.value_type==n&&(b.value_type=g),b.value_type!=n&&(ae(),ne())):4==T?(T=3,b.value_type!=n&&(oe(),ne())):(S=!1,re("bad context; excessive commas while parsing;",X)),E=!1;break;default:if(3==T)switch(X){case 96:case 34:case 39:0==D?se(X)?b.value_type=s:(K=X,$=!0):re("fault while parsing; quote not at start of field name",X);break;case 10:F.line++,F.col=1;case 13:case 32:case 9:case 65279:if(31==D){D=0,T==y&&(Q=!0);break}if(0==D||30==D)break;29==D?D=30:(S=!1,re("fault while parsing; whitepsace unexpected",X));break;default:30==D&&(S=!1,re("fault while parsing; character unexpected",X)),0==D&&(D=29),b.string+=j}else switch(X){case 96:case 34:case 39:se(X)?(b.value_type=s,D=31):(K=X,$=!0);break;case 10:F.line++,F.col=1;case 32:case 9:case 13:case 65279:if(31==D){D=0,T==y&&(Q=!0);break}if(0==D)break;29==D?D=30:(S=!1,re("fault parsing whitespace",X));break;case 116:0==D?D=1:27==D?D=28:(S=!1,re("fault parsing",X));break;case 114:1==D?D=2:(S=!1,re("fault parsing",X));break;case 117:2==D?D=3:9==D?D=10:0==D?D=12:(S=!1,re("fault parsing",X));break;case 101:3==D?(b.value_type=a,D=31):8==D?(b.value_type=o,D=31):14==D?D=15:18==D?D=19:(S=!1,re("fault parsing",X));break;case 110:0==D?D=9:12==D?D=13:17==D?D=18:22==D?D=23:25==D?D=26:(S=!1,re("fault parsing",X));break;case 100:13==D?D=14:19==D?(b.value_type=r,D=31):(S=!1,re("fault parsing",X));break;case 105:16==D?D=17:24==D?D=25:26==D?D=27:(S=!1,re("fault parsing",X));break;case 108:10==D?D=11:11==D?(b.value_type=i,D=31):6==D?D=7:(S=!1,re("fault parsing",X));break;case 102:0==D?D=5:15==D?D=16:23==D?D=24:(S=!1,re("fault parsing",X));break;case 97:5==D?D=6:20==D?D=21:(S=!1,re("fault parsing",X));break;case 115:7==D?D=8:(S=!1,re("fault parsing",X));break;case 73:0==D?D=22:(S=!1,re("fault parsing",X));break;case 78:0==D?D=20:21==D?(b.value_type=E?f:p,E=!1,D=31):(S=!1,re("fault parsing",X));break;case 121:28==D?(b.value_type=E?h:v,E=!1,D=31):(S=!1,re("fault parsing",X));break;case 45:0==D?E=!E:(S=!1,re("fault parsing",X));break;default:X>=48&&X<=57||43==X||46==X||45==X?(M=!1,L=!1,R=!1,I=!1,C=!1,b.string=j,Y.n=x,ue()):(S=!1,re("fault parsing",X))}}if(Q){31==D&&(D=0);break}}if(x==ee.length?(k(Y),$||U||3==T?te=0:T!=y||b.value_type==n&&!O||(Q=!0,te=1)):(Y.n=x,B.unshift(Y),te=2),Q)break}if(!S)return-1;if(Q&&b.value_type!=n){switch(b.value_type){case u:O=ie(b.string);break;case s:O=b.string;break;case a:O=!0;break;case o:O=!1;break;case i:O=null;break;case r:O=void 0;break;case p:case f:O=NaN;break;case v:O=1/0;break;case h:O=-1/0;break;case c:case l:O=b.contains}E=!1,b.string="",b.value_type=n}return Q=!1,te}}};const j=[Object.freeze(F.begin())];var x=0;F.parse=function(e,t){var r,n=x++;if(j.length<=n&&j.push(Object.freeze(F.begin())),r=j[n],"string"!=typeof e&&(e=String(e)),r.reset(),r._write(e,!0)>0){var i=r.value();return"function"==typeof t&&function e(r,n){var i,a,o=r[n];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(a=e(o,i))?o[i]=a:delete o[i]);return t.call(r,n,o)}({"":i},""),x--,i}},F.stringify=JSON.stringify}(h={exports:{}},h.exports),h.exports),g=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},y=function(e){return v.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},b=function(e){var t=e.object;if(Array.isArray(t)){var r=f(t,3);return{value:r[0],options:r[1],extraOpts:r[2]}}return{value:t}},d=function(t){var r,n,i=t.value,a=t.arg,s=(t.key,t.locale);if("string"==typeof i||i&&"object"===e(i)&&"nodeType"in i)return i;var u=function(e){var t=e.type,n=e.options,i=void 0===n?r:n,s=e.checkArgOptions,u=void 0!==s&&s;if("string"==typeof a){var c=f(a.split("|"),3),l=c[0],p=c[1],h=c[2];l===t&&(p?u&&!h||(i=o({},i,{},y(u&&h?h:p))):i={})}return i};if(i&&"object"===e(i)){var c=Object.keys(i)[0];if(["number","date","relative","list","plural"].includes(c)){var l=b({object:i[c]});switch(i=l.value,r=l.options,n=l.extraOpts,c){case"relative":var p=[r,n];return n=p[0],r=p[1],new Intl.RelativeTimeFormat(s,u({type:"RELATIVE"})).format(i,n);case"list":return i.sort(new Intl.Collator(s,u({type:"LIST",options:n,checkArgOptions:!0})).compare),new Intl.ListFormat(s,u({type:"LIST"})).format(i)}}}if("number"==typeof i)return new Intl.NumberFormat(s,u({type:"NUMBER"})).format(i);if(i&&"object"===e(i)&&"function"==typeof i.getTime)return new Intl.DateTimeFormat(s,u({type:"DATETIME"})).format(i);throw new TypeError("Unknown formatter")},m=function e(){t(this,e)},w=function(e){var t=e.key,r=e.body,n=e.type,i=e.messageStyle,a=C({messageStyle:void 0===i?"richNested":i})({body:r},t);if(!a)throw new Error("Key value not found for ".concat(n," key: (").concat(t,")"));return a.value},k=function(e){function r(e){var n;return t(this,r),(n=l(this,u(r).call(this))).locals=e,n}return s(r,m),n(r,[{key:"getSubstitution",value:function(e){return w({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),r=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in r;return r=r[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),r}(),F=function(e){function r(e){var n;return t(this,r),(n=l(this,u(r).call(this))).substitutions=e,n}return s(r,m),n(r,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),r}(),j=function(r){function i(e,r){var n,a=r.substitutions;return t(this,i),(n=l(this,u(i).call(this))).switches=e,n.substitutions=a,n}return s(i,m),n(i,[{key:"getSubstitution",value:function(t,r){var n=r.locale,i=r.usedKeys,a=r.arg,s=r.missingSuppliedFormatters,u=this.constructor.getKey(t).slice(1);i.push(u);var c,l,p=Object.keys(this.switches).find((function(e){return e.split("|")[0]===u})),h=this.switches[p];if(p&&p.includes("|")){var v=f(p.split("|"),3);c=v[1],l=v[2]}if(!h)return s({key:t,formatter:this}),"\\{"+t+"}";var g=function(e,t){var r=y(l);return new Intl.NumberFormat(n,o({},t,{},r)).format(e)},d=function(e,t){var r=y(l);return new Intl.PluralRules(n,o({},t,{},r)).select(e)},m=this.substitutions[u],k=m;if("number"==typeof m)switch(c){case"NUMBER":k=g(m);break;case"PLURAL":k=d(m);break;default:k=new Intl.PluralRules(n).select(m)}else if(m&&"object"===e(m)){var F=Object.keys(m)[0];if(["number","plural"].includes(F)){var j=b({object:m[F]}),x=j.value,D=j.options;if(c||(c=F.toUpperCase()),!(F.toUpperCase()===c))throw new TypeError('Expecting type "'.concat(c.toLowerCase(),'"; instead found "').concat(F,'".'));switch(c){case"NUMBER":k=g(x,D);break;case"PLURAL":k=d(x,D)}}}var S=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return w({messageStyle:"richNested",key:k?S(k):a,body:h,type:"switch"})}catch(e){try{return w({messageStyle:"richNested",key:"*"+S(k),body:h,type:"switch"})}catch(e){var E=Object.keys(h).find((function(e){return e.startsWith("*")}));if(!E)throw new Error("No defaults found for switch ".concat(u));return w({messageStyle:"richNested",key:S(E),body:h,type:"switch"})}}}},{key:"isMatch",value:function(e){var t=this;return e&&this.constructor.isMatchingKey(e)&&Object.keys(this.switches).some((function(r){return e.slice(1)===t.constructor.getKey(r)}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:[\0-\{\}-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/);return t&&t[0]}}]),i}();function x(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function D(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function S(e,t,r){if(!e.s){if(r instanceof E){if(!r.s)return void(r.o=S.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(S.bind(null,e,t),S.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var E=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,i=this.s;if(i){var a=1&i?t:r;if(a){try{S(n,1,a(this.v))}catch(e){S(n,2,e)}return n}return this}return this.o=function(e){try{var i=e.v;1&e.s?S(n,1,t?t(i):i):r?S(n,1,r(i)):S(n,2,i)}catch(e){S(n,2,e)}},n},e}();function O(e){return e instanceof E&&1&e.s}function _(e,t,r){for(var n;;){var i=e();if(O(i)&&(i=i.v),!i)return a;if(i.then){n=0;break}var a=r();if(a&&a.then){if(!O(a)){n=1;break}a=a.s}if(t){var o=t();if(o&&o.then&&!O(o)){n=2;break}}}var s=new E,u=S.bind(null,s,2);return(0===n?i.then(l):1===n?a.then(c):o.then(f)).then(void 0,u),s;function c(n){a=n;do{if(t&&(o=t())&&o.then&&!O(o))return void o.then(f).then(void 0,u);if(!(i=e())||O(i)&&!i.v)return void S(s,1,a);if(i.then)return void i.then(l).then(void 0,u);O(a=r())&&(a=a.v)}while(!a||!a.then);a.then(c).then(void 0,u)}function l(e){e?(a=r())&&a.then?a.then(c).then(void 0,u):c(a):S(s,1,a)}function f(){(i=e())?i.then?i.then(l).then(void 0,u):l(i):S(s,1,a)}}function P(e,t){return e&&e.then?e.then(t):t(e)}function A(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var T=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return A((function(){var n,i,a=!1,o=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return P(_((function(){return!a}),void 0,(function(){var s=e.shift();return D((function(){return x(o,(function(e){n=e,a=!0}))}),(function(){if(i)throw new Error(r);e.length||(i=!0),o=t(s)}))})),(function(e){return n}))}))()},N=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},M=function(t){var r=t.string,n=t.dom,i=t.usedKeys,a=t.substitutions,s=t.allSubstitutions,u=t.locale,c=t.locals,l=t.switches,h=t.maximumLocalNestingDepth,v=void 0===h?3:h,b=t.missingSuppliedFormatters,m=t.checkExtraSuppliedFormatters;if("number"!=typeof v)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var w=new k(c),x=new F(a),D=new j(l,{substitutions:a}),S=/(\\*)\{((?:(?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\\\})*?)(?:(\|)((?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*))?\}/g;s&&(s=Array.isArray(s)?s:[s]);var E=function(e){var t,r=e.key,n=e.arg,a=e.substs;return w.constructor.isMatchingKey(r)?t=w.getSubstitution(r):D.constructor.isMatchingKey(r)?t=D.getSubstitution(r,{locale:u,usedKeys:i,arg:n,missingSuppliedFormatters:b}):"function"==typeof(t=a[r])&&(t=t({arg:n,key:r})),s?t=s.reduce((function(e,t){return t({value:e,arg:n,key:r,locale:u})}),t):n&&n.match(/^(?:NUMBER|DATETIME|RELATIVE|LIST)(?:\||$)/)&&(t=d({value:t,arg:n,key:r,locale:u})),t},O=1,_=function(e){var t=e.substitution,r=e.ky,n=e.arg,i=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(O++>v)throw new TypeError("Too much recursion in local variables.");if(w.constructor.isMatchingKey(r)){var s,u=a;n&&(s=y(n),u=o({},a,{},s)),t=i({str:t,substs:u,formatter:w}),s&&m({substitutions:s})}else D.constructor.isMatchingKey(r)&&(t=i({str:t}))}return t};if(!n){var P=!1,A=function t(r){var n=r.str,o=r.substs,s=void 0===o?a:o,u=r.formatter,c=void 0===u?x:u;return n.replace(S,(function(r,n,a,o,u){if(n.length%2)return r;if(b({key:a,formatter:c}))return r;var l=E({key:a,arg:u,substs:s});return l=_({substitution:l,ky:a,arg:u,processSubsts:t}),P=P||l&&"object"===e(l)&&"nodeType"in l,i.push(a),n+l}))}({str:r});if(!P)return m({substitutions:a}),i.length=0,g(A);i.length=0}O=1;var T=function t(r){for(var n,o=r.str,s=r.substs,u=void 0===s?a:s,c=r.formatter,l=void 0===c?x:c,h=[],v=0,g=new RegExp(S,"gu");null!==(n=g.exec(o));){var y=f(n,5),d=y[0],m=y[1],w=y[2],k=y[4],F=g.lastIndex,j=F-d.length;if(j>v&&h.push(o.slice(v,j)),m.length%2)h.push(d),v=F;else{if(b({key:w,formatter:l}))h.push(d);else{m.length&&h.push(m);var D=E({key:w,arg:k,substs:u});D=_({substitution:D,ky:w,arg:k,processSubsts:t}),Array.isArray(D)?h.push.apply(h,p(D)):D&&"object"===e(D)&&"nodeType"in D?h.push(D.cloneNode(!0)):h.push(D)}v=F,i.push(w)}}return v!==o.length&&h.push(o.slice(v)),h}({str:r});return m({substitutions:a}),i.length=0,T.map((function(e){return"string"==typeof e?g(e):e}))},C=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.messageStyle,n=void 0===r?"richNested":r;return"function"==typeof n?n:"richNested"===n?function(t,r){for(var n,i=t&&"object"===e(t)&&t.body,a=[],o=/(\\*)\./g,s=0,u=function(e){a.length||(a[0]=""),a[a.length-1]+=e};null!==(n=o.exec(r));){var c=f(n,2),l=c[0],p=c[1],h=o.lastIndex,v=h-l.length;v>s&&u(r.slice(s,v)),p.length%2?(s=h,u(l)):(u(p),a.push(""),s=h)}s!==r.length&&u(r.slice(s));var y=a.map((function(e){return g(e)})),b=!1,d=i;return y.some((function(t,r,n){return!d||"object"!==e(d)||(r===n.length-1&&t in d&&d[t]&&"object"===e(d[t])&&"message"in d[t]&&"string"==typeof d[t].message&&(b={value:d[t].message,info:d[t]}),d=d[t],!1)})),b}:"rich"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"object"===e(n[r])&&"message"in n[r]&&"string"==typeof n[r].message)&&{value:n[r].message,info:n[r]}}:"plain"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"string"==typeof n[r])&&{value:n[r]}}:function(){throw new TypeError("Unknown `messageStyle` ".concat(n))}()},L=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.message,i=r.defaults,a=r.messageStyle,o=r.messageForKey,s=void 0===o?C({messageStyle:a}):o,u=r.key;if("string"!=typeof u)throw new TypeError("An options object with a `key` string is expected on `getStringFromMessageAndDefaults`");if("string"==typeof n)t=n;else if(!1===i||null==i)t=!1;else{if(!i||"object"!==e(i))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(t=s({body:i},u))&&(t=t.value)}if(!1===t)throw new Error("Key value not found for key: (".concat(u,")"));return t},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,r=e.locale,n=e.locals,i=e.switches,a=(e.maximumLocalNestingDepth,e.allSubstitutions),o=void 0===a?[d]:a,s=e.insertNodes,u=void 0===s?M:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,h=void 0!==f&&f,v=e.forceNodeReturn,g=void 0!==v&&v,y=e.throwOnMissingSuppliedFormatters,b=void 0===y||y,m=e.throwOnExtraSuppliedFormatters,w=void 0===m||m;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var k=function(e){return g?document.createTextNode(e):e},F=[],j=function(e){var t=e.substitutions;w&&Object.keys(t).forEach((function(e){if(!F.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},x=function(e){var t=e.key,r=e.formatter,n=r.isMatch(t);if(r.constructor.isMatchingKey(t)&&!n){if(b)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!o&&!b)return k(t);l||(l={});var D=u({string:t,dom:h,usedKeys:F,substitutions:l,allSubstitutions:o,locale:r,locals:n,switches:i,missingSuppliedFormatters:x,checkExtraSuppliedFormatters:j});if("string"==typeof D)return k(D);var S=document.createDocumentFragment();return S.append.apply(S,p(D)),S};function I(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function B(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function K(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var $=B((function(){var e=B((function(t){if("string"!=typeof t)throw new TypeError("Non-string locale type");var r=s(c,t);if("string"!=typeof r)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return K((function(){return I(fetch(r),(function(e){if(404===e.status)throw new Error("Trying again");return I(e.json(),(function(e){return{locale:t,strings:e}}))}))}),(function(r){if("SyntaxError"===r.name)throw r;return I(f(t),e)}))})),t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.locales,n=void 0===r?navigator.languages:r,i=t.defaultLocales,a=void 0===i?["en-US"]:i,o=t.localeResolver,s=void 0===o?N:o,u=t.localesBasePath,c=void 0===u?".":u,l=t.localeMatcher,f=void 0===l?"lookup":l;if("lookup"===f)f=function(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*$/,"")};else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return T([].concat(p(n),p(a)),e,"No matching locale found!")}));function U(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var q=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.locales,n=t.defaultLocales,i=t.localesBasePath,a=t.localeResolver,s=t.localeMatcher,u=t.messageStyle,c=t.allSubstitutions,l=t.insertNodes,f=t.defaults,p=t.substitutions,h=t.dom,v=void 0!==h&&h,g=t.forceNodeReturn,y=void 0!==g&&g,b=t.maximumLocalNestingDepth,d=t.throwOnMissingSuppliedFormatters,m=void 0===d||d,w=t.throwOnExtraSuppliedFormatters,k=void 0===w||w;try{return U($({locales:r,defaultLocales:n,localeResolver:a,localesBasePath:i,localeMatcher:s}),(function(t){var r=t.strings,n=t.locale;if(!r||"object"!==e(r))throw new TypeError("Locale strings must be an object!");var i=C({messageStyle:u});return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.allSubstitutions,u=void 0===s?c:s,h=a.defaults,g=void 0===h?f:h,d=a.dom,w=void 0===d?v:d,F=a.forceNodeReturn,j=void 0===F?y:F,x=a.throwOnMissingSuppliedFormatters,D=void 0===x?m:x,S=a.throwOnExtraSuppliedFormatters,E=void 0===S?k:S,O=i(r,e),_=L({message:O&&O.value||!1,defaults:g,messageForKey:i,key:e});return R({string:_,locals:r.head&&r.head.locals,switches:r.head&&r.head.switches,locale:n,maximumLocalNestingDepth:b,allSubstitutions:u,insertNodes:l,substitutions:o({},p,{},t),dom:w,forceNodeReturn:j,throwOnMissingSuppliedFormatters:D,throwOnExtraSuppliedFormatters:E})}}))}catch(e){return Promise.reject(e)}};export{m as Formatter,k as LocalFormatter,F as RegularFormatter,j as SwitchFormatter,d as defaultAllSubstitutions,M as defaultInsertNodes,N as defaultLocaleResolver,$ as findLocaleStrings,R as getDOMForLocaleString,C as getMessageForKeyByStyle,L as getStringFromMessageAndDefaults,q as i18n,y as parseJSONExtra,T as promiseChainForValues,g as unescapeBackslashes};
//# sourceMappingURL=index.esm.min.js.map
