function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return function(){var t,r=u(e);if(l()){var n=u(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return f(this,t)}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d,b=(function(e,t){const r=[];function n(){var e=r.pop();return e||(e={context:0,elements:null,element_array:null}),e}function a(e){r.push(e)}const o=[];function i(e){o.push(e)}var s=t;s.escape=function(e){var t,r="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(r+="\\"),r+=e[t];return r},s.begin=function(e,t){const r={name:null,value_type:0,string:"",contains:null},s={line:1,col:1};let u,c=0;var l=0,f=!0,p=!1,h=null,v=void 0,y=[],g={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},pop(){var e=this.last;return e?((this.last=e.prior)||(this.first=null),e.next=this.saved,this.saved=e,e.node):null}},d=0,b=0,m=!1,w=!1,k=!1,F=!1,x=!1,S={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=this.first,t.prior=null):t={node:e,next:this.first,prior:null},this.first||(this.last=t),this.first=t}},D=null,E=!1,j=!1,O=!1,M=!1,_=!1,A=!1,P=!1,T=0,N=0,L=!1,R=!1;return{value(){var e=h;return h=void 0,e},reset(){l=0,f=!0,S.last&&(S.last.next=S.save),S.save=S.first,S.first=S.last=null,g.last&&(g.last.next=g.save),g.save=S.first,g.first=g.last=null,y=null,v=void 0,d=0,r.value_type=0,r.name=null,r.string="",s.line=1,s.col=1,p=!1,b=0,R=!1,E=!1,O=!1,M=!1},write(r){var n;for("string"!=typeof r&&(r=String(r)),n=this._write(r,!1);n>0&&(h&&("function"==typeof t&&function e(r,n){var a,o,i=r[n];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(void 0!==(o=e(i,a))?i[a]=o:delete i[a]);return t.call(r,n,i)}({"":h},""),e(h),h=void 0),!(n<2));n=this._write());},_write(e,t){var I,C,B,K=0;function $(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${c} (near '${B.substr(c>4?c-4:0,c>4?3:c-1)}[${String.fromCodePoint(t)}]${B.substr(c,10)}') [${s.line}:${s.col}]`)}function U(){r.value_type=0,r.string=""}function q(e){return e.length>1&&!m&&!w&&!k&&48===e.charCodeAt(0)?(p?-1:1)*Number("0o"+e):(p?-1:1)*Number(e)}function V(){switch(r.value_type){case 5:y.push(q(r.string));break;case 4:y.push(r.string);break;case 2:y.push(!0);break;case 3:y.push(!1);break;case 8:case 9:y.push(NaN);break;case 10:y.push(-1/0);break;case 11:y.push(1/0);break;case 1:y.push(null);break;case-1:y.push(void 0);break;case 13:y.push(void 0),delete y[y.length-1];break;case 6:case 7:y.push(r.contains);break;default:console.log("Unhandled array push.")}}function z(){switch(r.value_type){case 5:v[r.name]=q(r.string);break;case 4:v[r.name]=r.string;break;case 2:v[r.name]=!0;break;case 3:v[r.name]=!1;break;case 8:case 9:v[r.name]=NaN;break;case 10:v[r.name]=-1/0;break;case 11:v[r.name]=1/0;break;case 1:v[r.name]=null;break;case-1:v[r.name]=void 0;break;case 6:case 7:v[r.name]=r.contains}}function W(e){let t=0;for(;0==t&&c<B.length;){u=B.charAt(c);let n=B.codePointAt(c++);if(n>=65536&&(u+=B.charAt(c),c++),s.col++,n==e)O?(r.string+=u,O=!1):(t=-1,L?$("Incomplete Octal sequence",n):P?$("Incomplete hexidecimal sequence",n):A?$("Incomplete unicode sequence",n):_&&$("Incomplete long unicode sequence",n),t=1);else if(O){if(L){if(N<3&&n>=48&&n<=57){if(T*=8,T+=n-48,3==++N){r.string+=String.fromCodePoint(T),L=!1,O=!1;continue}continue}if(T>255){$("(escaped character, parsing octal escape val=%d) fault while parsing",n),t=-1;break}r.string+=String.fromCodePoint(T),L=!1,O=!1;continue}if(_){if(125==n){r.string+=String.fromCodePoint(T),_=!1,A=!1,O=!1;continue}if(T*=16,n>=48&&n<=57)T+=n-48;else if(n>=65&&n<=70)T+=n-65+10;else{if(!(n>=97&&n<=102)){$("(escaped character, parsing hex of \\u)",n),t=-1,_=!1,O=!1;continue}T+=n-97+10}continue}if(P||A){if(0===N&&123===n){_=!0;continue}if(N<2||A&&N<4){if(T*=16,n>=48&&n<=57)T+=n-48;else if(n>=65&&n<=70)T+=n-65+10;else{if(!(n>=97&&n<=102)){$(A?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",n),t=-1,P=!1,O=!1;continue}T+=n-97+10}N++,A?4==N&&(r.string+=String.fromCodePoint(T),A=!1,O=!1):2==N&&(r.string+=String.fromCodePoint(T),P=!1,O=!1);continue}}switch(n){case 13:M=!0,s.col=1;continue;case 10:case 2028:case 2029:s.line++;break;case 116:r.string+="\t";break;case 98:r.string+="\b";break;case 110:r.string+="\n";break;case 114:r.string+="\r";break;case 102:r.string+="\f";break;case 48:case 49:case 50:case 51:L=!0,T=n-48,N=1;continue;case 120:P=!0,N=0,T=0;continue;case 117:A=!0,N=0,T=0;continue;default:r.string+=u}O=!1}else if(92===n)O?(r.string+="\\",O=!1):O=!0;else{if(M){if(M=!1,10==n){s.line++,s.col=1,O=!1;continue}s.line++,s.col=1;continue}r.string+=u}}return t}function H(){let e;for(;(e=c)<B.length;){u=B.charAt(e);let n=B.codePointAt(c++);if(n>=65536&&($("fault while parsing number;",n),u+=B.charAt(c),c++),95!=n)if(s.col++,n>=48&&n<=57)k&&(x=!0),r.string+=u;else if(45==n||43==n){if(0!=r.string.length&&(!k||F||x)){f=!1,$("fault while parsing number;",n);break}r.string+=u,F=!0}else if(46==n){if(w||m||k){f=!1,$("fault while parsing number;",n);break}r.string+=u,w=!0}else if(120==n||98==n||111==n||88==n||66==n||79==n){if(m||"0"!=r.string){f=!1,$("fault while parsing number;",n);break}m=!0,r.string+=u}else{if(101!=n&&69!=n){if(32==n||160==n||13==n||10==n||9==n||65279==n||44==n||125==n||93==n||58==n)break;t&&(f=!1,$("fault while parsing number;",n));break}if(k){f=!1,$("fault while parsing number;",n);break}r.string+=u,k=!0}}c=e,t||c!=B.length?(j=!1,r.value_type=5,0==d&&(R=!0)):j=!0}if(!f)return-1;for(e&&e.length?((C=function(){var e=o.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=e,S.push(C)):j&&(j=!1,r.value_type=5,0==d&&(R=!0),K=1);f&&(C=S.shift());){if(c=C.n,B=C.buf,E){let e=W(D);e<0?f=!1:e>0&&(E=!1,f&&(r.value_type=4))}for(j&&H();!R&&f&&c<B.length;){if(u=B.charAt(c),(I=B.codePointAt(c++))>=65536&&(u+=B.charAt(c),c++),s.col++,b){if(1==b){if(42==I){b=3;continue}47!=I?($("fault while parsing;",I),f=!1):b=2;continue}if(2==b){if(10==I){b=0;continue}continue}if(3==b){if(42==I){b=4;continue}continue}if(4==b){if(47==I){b=0;continue}42!=I&&(b=3);continue}}switch(I){case 47:b||(b=1);break;case 123:if(29==l||30==l||3==d&&0==l){$("fault while parsing; getting field name unexpected ",I),f=!1;break}{let e=n();r.value_type=6;let t={};0==d?h=v=t:4==d&&(v[r.name]=t),e.context=d,e.elements=v,e.element_array=y,e.name=r.name,v=t,g.push(e),U(),d=3}break;case 91:if(3==d||29==l||30==l){$("Fault while parsing; while getting field name unexpected",I),f=!1;break}{let e=n();r.value_type=7;let t=[];0==d?h=y=t:4==d&&(v[r.name]=t),e.context=d,e.elements=v,e.element_array=y,e.name=r.name,y=t,g.push(e),U(),d=1}break;case 58:if(3==d){if(0!=l&&29!=l&&30!=l){f=FALSE,thorwError(`fault while parsing; unquoted keyword used as object field name (state:${l})`,I);break}l=0,r.name=r.string,r.string="",d=4,r.value_type=0}else $(1==d?"(in array, got colon out of string):parsing fault;":"(outside any object, got colon out of string):parsing fault;",I),f=!1;break;case 125:if(31==l&&(l=0),3==d){U();let e=g.pop();d=e.context,v=e.elements,y=e.element_array,a(e),0==d&&(R=!0)}else if(4==d){0!=r.value_type&&z(),r.value_type=6,r.contains=v;var J=g.pop();r.name=J.name,d=J.context,v=J.elements,y=J.element_array,a(J),0==d&&(R=!0)}else $("Fault while parsing; unexpected",I),f=!1;p=!1;break;case 93:31==l&&(l=0),1==d?(0!=r.value_type&&V(),r.value_type=7,r.contains=y,J=g.pop(),r.name=J.name,d=J.context,v=J.elements,y=J.element_array,a(J),0==d&&(R=!0)):($(`bad context ${d}; fault while parsing`,I),f=!1),p=!1;break;case 44:31==l&&(l=0),1==d?(0==r.value_type&&(r.value_type=13),0!=r.value_type&&(V(),U())):4==d?(d=3,0!=r.value_type&&(z(),U())):(f=!1,$("bad context; excessive commas while parsing;",I)),p=!1;break;default:if(3==d)switch(I){case 96:case 34:case 39:0==l?W(I)?r.value_type=4:(D=I,E=!0):$("fault while parsing; quote not at start of field name",I);break;case 10:s.line++,s.col=1;case 13:case 32:case 160:case 9:case 65279:if(31==l){l=0,0==d&&(R=!0);break}if(0==l||30==l)break;29==l?l=30:(f=!1,$("fault while parsing; whitepsace unexpected",I));break;default:30==l&&(f=!1,$("fault while parsing; character unexpected",I)),0==l&&(l=29),r.string+=u}else switch(I){case 96:case 34:case 39:W(I)?(r.value_type=4,l=31):(D=I,E=!0);break;case 10:s.line++,s.col=1;case 32:case 160:case 9:case 13:case 65279:if(31==l){l=0,0==d&&(R=!0);break}if(0==l)break;29==l?l=30:(f=!1,$("fault parsing whitespace",I));break;case 116:0==l?l=1:27==l?l=28:(f=!1,$("fault parsing",I));break;case 114:1==l?l=2:(f=!1,$("fault parsing",I));break;case 117:2==l?l=3:9==l?l=10:0==l?l=12:(f=!1,$("fault parsing",I));break;case 101:3==l?(r.value_type=2,l=31):8==l?(r.value_type=3,l=31):14==l?l=15:18==l?l=19:(f=!1,$("fault parsing",I));break;case 110:0==l?l=9:12==l?l=13:17==l?l=18:22==l?l=23:25==l?l=26:(f=!1,$("fault parsing",I));break;case 100:13==l?l=14:19==l?(r.value_type=-1,l=31):(f=!1,$("fault parsing",I));break;case 105:16==l?l=17:24==l?l=25:26==l?l=27:(f=!1,$("fault parsing",I));break;case 108:10==l?l=11:11==l?(r.value_type=1,l=31):6==l?l=7:(f=!1,$("fault parsing",I));break;case 102:0==l?l=5:15==l?l=16:23==l?l=24:(f=!1,$("fault parsing",I));break;case 97:5==l?l=6:20==l?l=21:(f=!1,$("fault parsing",I));break;case 115:7==l?l=8:(f=!1,$("fault parsing",I));break;case 73:0==l?l=22:(f=!1,$("fault parsing",I));break;case 78:0==l?l=20:21==l?(r.value_type=p?8:9,p=!1,l=31):(f=!1,$("fault parsing",I));break;case 121:28==l?(r.value_type=p?10:11,p=!1,l=31):(f=!1,$("fault parsing",I));break;case 45:0==l?p=!p:(f=!1,$("fault parsing",I));break;default:I>=48&&I<=57||43==I||46==I||45==I?(m=!1,k=!1,F=!1,x=!1,w=!1,r.string=u,C.n=c,H()):(f=!1,$("fault parsing",I))}}if(R){31==l&&(l=0);break}}if(c==B.length?(i(C),E||j||3==d?K=0:0!=d||0==r.value_type&&!h||(R=!0,K=1)):(C.n=c,S.unshift(C),K=2),R)break}if(!f)return-1;if(R&&0!=r.value_type){switch(r.value_type){case 5:h=q(r.string);break;case 4:h=r.string;break;case 2:h=!0;break;case 3:h=!1;break;case 1:h=null;break;case-1:h=void 0;break;case 9:case 8:h=NaN;break;case 11:h=1/0;break;case 10:h=-1/0;break;case 6:case 7:h=r.contains}p=!1,r.string="",r.value_type=0}return R=!1,K}}};const u=[Object.freeze(s.begin())];var c=0;s.parse=function(e,t){var r,n=c++;if(u.length<=n&&u.push(Object.freeze(s.begin())),r=u[n],"string"!=typeof e&&(e=String(e)),r.reset(),r._write(e,!0)>0){var a=r.value();return"function"==typeof t&&function e(r,n){var a,o,i=r[n];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(void 0!==(o=e(i,a))?i[a]=o:delete i[a]);return t.call(r,n,i)}({"":a},""),c--,a}},s.stringify=JSON.stringify}(d={exports:{}},d.exports),d.exports),m=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},w=function(e){return b.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},k=function(e,t,r){var n,a=r.onMatch,o=r.extra,i=r.betweenMatches,s=r.afterMatch,u=r.escapeAtOne,c=0;for(o&&(i=o,s=o,u=o);null!==(n=e.exec(t));){var l=h(n,2),f=l[0],p=l[1],y=e.lastIndex,g=y-f.length;g>c&&i(t.slice(c,g)),u&&p.length%2?(c=y,u(f)):(a.apply(void 0,v(n)),c=y)}c!==t.length&&s(t.slice(c))},F="undefined"!=typeof fetch?fetch:null,x=function(e){F=e},S=function(){return F},D="undefined"!=typeof document?document:null,E=function(e){D=e},j=function(){return D};var O=function(e,t,r){return t.sort(new Intl.Collator(e,r).compare)},M=function(e,t,r){return new Intl.ListFormat(e,r).format(t)},_=function(e,t,r,n,a){if("function"!=typeof r)return function(e,t,r,n){return O(e,t,n),M(e,t,r)}(e,t,r,n);O(e,t,a);var o,i=(o=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(o+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:3&t|8).toString(16)}))),s=v(t).map((function(e,t){return"<<".concat(i).concat(t,">>")})),u=[],c=function(){u.push.apply(u,arguments)};k(new RegExp("<<".concat(i,"(\\d)>>"),"gu"),M(e,s,n),{betweenMatches:c,afterMatch:c,onMatch:function(e,n){c(r(t[n],n))}});var l=j().createDocumentFragment();return l.append.apply(l,u),l},A=function(e){var t=e.object;if(Array.isArray(t)){if("function"==typeof t[1]){var r=h(t,4);return{value:r[0],callback:r[1],options:r[2],extraOpts:r[3]}}var n=h(t,3);return{value:n[0],options:n[1],extraOpts:n[2]}}return{value:t}},P=function(t){var r,n=t.value,a=t.arg,o=(t.key,t.locale);if("string"==typeof n||n&&"object"===e(n)&&"nodeType"in n)return n;var s=function(e){var t=e.type,n=e.options,o=void 0===n?r:n,s=e.checkArgOptions,u=void 0!==s&&s;if("string"==typeof a){var c=h(a.split("|"),3),l=c[0],f=c[1],p=c[2];"DATE"===l&&(l="DATETIME"),l===t&&(f?u&&!p||(o=i({},o,{},w(u&&p?p:f))):o={})}return o};if(n&&"object"===e(n)){var u=Object.keys(n)[0];if(["number","date","datetime","relative","list","plural"].includes(u)){var c,l,f=A({object:n[u]});switch(n=f.value,r=f.options,c=f.extraOpts,l=f.callback,u){case"relative":var p=[r,c];return c=p[0],r=p[1],new Intl.RelativeTimeFormat(o,s({type:"RELATIVE"})).format(n,c);case"list":return l?_(o,n,l,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0})):_(o,n,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0}))}}}if("number"==typeof n)return new Intl.NumberFormat(o,s({type:"NUMBER"})).format(n);if(n&&"object"===e(n)&&"function"==typeof n.getTime)return new Intl.DateTimeFormat(o,s({type:"DATETIME"})).format(n);throw new TypeError("Unknown formatter")},T=function e(){t(this,e)},N=function(e){var t=e.key,r=e.body,n=e.type,a=e.messageStyle,o=Z({messageStyle:void 0===a?"richNested":a})({body:r},t);if(!o)throw new Error("Key value not found for ".concat(n," key: (").concat(t,")"));return o.value},L=function(e){s(a,T);var r=p(a);function a(e){var n;return t(this,a),(n=r.call(this)).locals=e,n}return n(a,[{key:"getSubstitution",value:function(e){return N({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),r=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in r;return r=r[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),a}(),R=function(e){s(a,T);var r=p(a);function a(e){var n;return t(this,a),(n=r.call(this)).substitutions=e,n}return n(a,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),a}(),I=function(r){s(o,T);var a=p(o);function o(e,r){var n,i=r.substitutions;return t(this,o),(n=a.call(this)).switches=e,n.substitutions=i,n}return n(o,[{key:"getSubstitution",value:function(t,r){var n,a,o=r.locale,s=r.usedKeys,u=r.arg,c=r.missingSuppliedFormatters,l=this.constructor.getKey(t).slice(1),f=h(this.getMatch(l),3),p=f[0],v=f[1],y=f[2];if(s.push(y),p&&p.includes("|")){var g=h(p.split("|"),3);n=g[1],a=g[2]}if(!v)return c({key:t,formatter:this}),"\\{"+t+"}";var d=function(e,t){var r=w(a);return new Intl.NumberFormat(o,i({},t,{},r)).format(e)},b=function(e,t){var r=w(a);return new Intl.PluralRules(o,i({},t,{},r)).select(e)},m=this.substitutions[y],k=m;if("number"==typeof m)switch(n){case"NUMBER":k=d(m);break;case"PLURAL":k=b(m);break;default:k=new Intl.PluralRules(o).select(m)}else if(m&&"object"===e(m)){var F=Object.keys(m)[0];if(["number","plural"].includes(F)){var x=A({object:m[F]}),S=x.value,D=x.options;if(n||(n=F.toUpperCase()),!(F.toUpperCase()===n))throw new TypeError('Expecting type "'.concat(n.toLowerCase(),'"; instead found "').concat(F,'".'));switch(n){case"NUMBER":k=d(S,D);break;case"PLURAL":k=b(S,D)}}}var E=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return N({messageStyle:"richNested",key:k?E(k):u,body:v,type:"switch"})}catch(e){try{return N({messageStyle:"richNested",key:"*"+E(k),body:v,type:"switch"})}catch(e){var j=Object.keys(v).find((function(e){return e.startsWith("*")}));if(!j)throw new Error("No defaults found for switch ".concat(l));return N({messageStyle:"richNested",key:E(j),body:v,type:"switch"})}}}},{key:"isMatch",value:function(e){return e&&this.constructor.isMatchingKey(e)&&Boolean(this.getMatch(e.slice(1)).length)}},{key:"getMatch",value:function(e){var t=this,r=e.split(".");return r.reduce((function(n,a,o){if(o<r.length-1){if(!(a in n))throw new Error('Switch key "'.concat(a,'" not found (from "~').concat(e,'")'));return n[a]}var i=Object.entries(n).find((function(e){var r=h(e,1)[0];return a===t.constructor.getKey(r)}));return i?i.concat(a):[]}),this.switches)}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:[\0-\{\}-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/);return t&&t[0]}}]),o}();function C(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function B(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function K(e,t,r){if(!e.s){if(r instanceof $){if(!r.s)return void(r.o=K.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(K.bind(null,e,t),K.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var $=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,a=this.s;if(a){var o=1&a?t:r;if(o){try{K(n,1,o(this.v))}catch(e){K(n,2,e)}return n}return this}return this.o=function(e){try{var a=e.v;1&e.s?K(n,1,t?t(a):a):r?K(n,1,r(a)):K(n,2,a)}catch(e){K(n,2,e)}},n},e}();function U(e){return e instanceof $&&1&e.s}function q(e,t,r){for(var n;;){var a=e();if(U(a)&&(a=a.v),!a)return o;if(a.then){n=0;break}var o=r();if(o&&o.then){if(!U(o)){n=1;break}o=o.s}if(t){var i=t();if(i&&i.then&&!U(i)){n=2;break}}}var s=new $,u=K.bind(null,s,2);return(0===n?a.then(l):1===n?o.then(c):i.then(f)).then(void 0,u),s;function c(n){o=n;do{if(t&&(i=t())&&i.then&&!U(i))return void i.then(f).then(void 0,u);if(!(a=e())||U(a)&&!a.v)return void K(s,1,o);if(a.then)return void a.then(l).then(void 0,u);U(o=r())&&(o=o.v)}while(!o||!o.then);o.then(c).then(void 0,u)}function l(e){e?(o=r())&&o.then?o.then(c).then(void 0,u):c(o):K(s,1,o)}function f(){(a=e())?a.then?a.then(l).then(void 0,u):l(a):K(s,1,o)}}function V(e,t){return e&&e.then?e.then(t):t(e)}function z(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var W=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return z((function(){var n,a,o=!1,i=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return V(q((function(){return!o}),void 0,(function(){var s=e.shift();return B((function(){return C(i,(function(e){n=e,o=!0}))}),(function(){if(a)throw new Error(r);e.length||(a=!0),i=t(s)}))})),(function(e){return n}))}))()},H=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");if(/[\.\/\\]/.test(t))throw new TypeError("Locales cannot use file-reserved characters, `.`, `/` or `\\`");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},J=function(t){var r=t.string,n=t.dom,a=t.usedKeys,o=t.substitutions,s=t.allSubstitutions,u=t.locale,c=t.locals,l=t.switches,f=t.maximumLocalNestingDepth,p=void 0===f?3:f,h=t.missingSuppliedFormatters,y=t.checkExtraSuppliedFormatters;if("number"!=typeof p)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var g=new L(c),d=new R(o),b=new I(l,{substitutions:o}),F=/(\\*)\{((?:(?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\\\})*?)(?:(\|)((?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*))?\}/g;s&&(s=Array.isArray(s)?s:[s]);var x=function(e){var t,r=e.key,n=e.arg,o=e.substs;return g.constructor.isMatchingKey(r)?t=g.getSubstitution(r):b.constructor.isMatchingKey(r)?t=b.getSubstitution(r,{locale:u,usedKeys:a,arg:n,missingSuppliedFormatters:h}):"function"==typeof(t=o[r])&&(t=t({arg:n,key:r})),s?t=s.reduce((function(e,t){return t({value:e,arg:n,key:r,locale:u})}),t):n&&n.match(/^(?:NUMBER|DATE(?:TIME)?|RELATIVE|LIST)(?:\||$)/)&&(t=P({value:t,arg:n,key:r,locale:u})),t},S=1,D=function(e){var t=e.substitution,r=e.ky,n=e.arg,a=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(S++>p)throw new TypeError("Too much recursion in local variables.");if(g.constructor.isMatchingKey(r)){var s,u=o;n&&(s=w(n),u=i({},o,{},s)),t=a({str:t,substs:u,formatter:g}),s&&y({substitutions:s})}else b.constructor.isMatchingKey(r)&&(t=a({str:t}))}return t};if(!n){var E=!1,j=function t(r){var n=r.str,i=r.substs,s=void 0===i?o:i,u=r.formatter,c=void 0===u?d:u;return n.replace(F,(function(r,n,o,i,u){if(n.length%2)return r;if(h({key:o,formatter:c}))return r;var l=x({key:o,arg:u,substs:s});return l=D({substitution:l,ky:o,arg:u,processSubsts:t}),E=E||l&&"object"===e(l)&&"nodeType"in l,a.push(o),n+l}))}({str:r});if(!E)return y({substitutions:o}),a.length=0,m(j);a.length=0}S=1;var O=function t(r){var n=r.str,i=r.substs,s=void 0===i?o:i,u=r.formatter,c=void 0===u?d:u,l=[],f=new RegExp(F,"gu"),p=function(){l.push.apply(l,arguments)};return k(f,n,{extra:p,onMatch:function(r,n,o,i,u){if(h({key:o,formatter:c}))p(r);else{n.length&&p(n);var l=x({key:o,arg:u,substs:s});l=D({substitution:l,ky:o,arg:u,processSubsts:t}),Array.isArray(l)?p.apply(void 0,v(l)):l&&"object"===e(l)&&"nodeType"in l?p(l.cloneNode(!0)):p(l)}a.push(o)}}),l}({str:r});return y({substitutions:o}),a.length=0,O.map((function(e){return"string"==typeof e?m(e):e}))},Z=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.messageStyle,n=void 0===r?"richNested":r;return"function"==typeof n?n:"richNested"===n?function(t,r){var n=t&&"object"===e(t)&&t.body,a=[],o=function(e){a.length||(a[0]=""),a[a.length-1]+=e};k(/(\\*)\./g,r,{extra:o,onMatch:function(e,t){o(t),a.push("")}});var i=a.map((function(e){return m(e)})),s=!1,u=n;return i.some((function(t,r,n){return!u||"object"!==e(u)||(r===n.length-1&&t in u&&u[t]&&"object"===e(u[t])&&"message"in u[t]&&"string"==typeof u[t].message&&(s={value:u[t].message,info:u[t]}),u=u[t],!1)})),s}:"rich"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"object"===e(n[r])&&"message"in n[r]&&"string"==typeof n[r].message)&&{value:n[r].message,info:n[r]}}:"plain"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"string"==typeof n[r])&&{value:n[r]}}:function(){throw new TypeError("Unknown `messageStyle` ".concat(n))}()},G=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.message,a=r.defaults,o=r.messageStyle,i=r.messageForKey,s=void 0===i?Z({messageStyle:o}):i,u=r.key;if("string"!=typeof u)throw new TypeError("An options object with a `key` string is expected on `getStringFromMessageAndDefaults`");if("string"==typeof n)t=n;else if(!1===a||null==a)t=!1;else{if(!a||"object"!==e(a))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(t=s({body:a},u))&&(t=t.value)}if(!1===t)throw new Error("Key value not found for key: (".concat(u,")"));return t},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,r=e.locale,n=e.locals,a=e.switches,o=(e.maximumLocalNestingDepth,e.allSubstitutions),i=void 0===o?[P]:o,s=e.insertNodes,u=void 0===s?J:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,p=void 0!==f&&f,h=e.forceNodeReturn,y=void 0!==h&&h,g=e.throwOnMissingSuppliedFormatters,d=void 0===g||g,b=e.throwOnExtraSuppliedFormatters,m=void 0===b||b;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var w=function(e){var t=j();return y?t.createTextNode(e):e},k=[],F=function(e){var t=e.substitutions;m&&Object.keys(t).forEach((function(e){if(!k.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},x=function(e){var t=e.key,r=e.formatter,n=r.isMatch(t);if(r.constructor.isMatchingKey(t)&&!n){if(d)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!i&&!d)return w(t);l||(l={});var S=u({string:t,dom:p,usedKeys:k,substitutions:l,allSubstitutions:i,locale:r,locals:n,switches:a,missingSuppliedFormatters:x,checkExtraSuppliedFormatters:F});if("string"==typeof S)return w(S);var D=j(),E=D.createDocumentFragment();return E.append.apply(E,v(S)),E};function X(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function Y(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var ee=function(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:[\0-,\.-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*$/,"")},te=function(e){var t=e.locale,r=e.locales,n=e.localeResolver,a=void 0===n?ee:n;try{for(;!r.includes(t);)t=a(t)}catch(e){return!1}return t},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,a=e.localesBasePath,o=e.localeMatcher;return ae({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:a,localeMatcher:o})},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,a=e.localesBasePath,o=e.localeMatcher;return ae({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:a,localeMatcher:o,headOnly:!0})},ae=Y((function(e){var t=Y((function(e){if("string"!=typeof e)throw new TypeError("Non-string locale type");var r=s(c,e);if("string"!=typeof r)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}((function(){var t=S();return X(h?t(r,{method:"HEAD"}):t(r),(function(t){if(404===t.status)throw new Error("Trying again");return h?e:X(t.json(),(function(t){return{locale:e,strings:t}}))}))}),(function(r){if("SyntaxError"===r.name)throw r;return X(f(e),t)}))})),r=e.locales,n=void 0===r?"undefined"!=typeof intlDomLocale?[intlDomLocale]:"undefined"==typeof navigator?[]:navigator.languages:r,a=e.defaultLocales,o=void 0===a?["en-US"]:a,i=e.localeResolver,s=void 0===i?H:i,u=e.localesBasePath,c=void 0===u?".":u,l=e.localeMatcher,f=void 0===l?"lookup":l,p=e.headOnly,h=void 0!==p&&p;if("lookup"===f)f=ee;else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return W([].concat(v(n),v(o)),t,"No matching locale found!")}));function oe(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var ie=function(t){var r=t.strings,n=t.resolvedLocale,a=t.messageStyle,o=t.allSubstitutions,s=t.insertNodes,u=t.defaults,c=t.substitutions,l=t.maximumLocalNestingDepth,f=t.dom,p=void 0!==f&&f,h=t.forceNodeReturn,v=void 0!==h&&h,y=t.throwOnMissingSuppliedFormatters,g=void 0===y||y,d=t.throwOnExtraSuppliedFormatters,b=void 0===d||d;if(!r||"object"!==e(r))throw new TypeError("Locale strings must be an object!");var m=Z({messageStyle:a}),w=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=a.allSubstitutions,h=void 0===f?o:f,y=a.defaults,d=void 0===y?u:y,w=a.dom,k=void 0===w?p:w,F=a.forceNodeReturn,x=void 0===F?v:F,S=a.throwOnMissingSuppliedFormatters,D=void 0===S?g:S,E=a.throwOnExtraSuppliedFormatters,j=void 0===E?b:E,O=m(r,e),M=G({message:O&&O.value||!1,defaults:d,messageForKey:m,key:e});return Q({string:M,locals:r.head&&r.head.locals,switches:r.head&&r.head.switches,locale:n,maximumLocalNestingDepth:l,allSubstitutions:h,insertNodes:s,substitutions:i({},c,{},t),dom:k,forceNodeReturn:x,throwOnMissingSuppliedFormatters:D,throwOnExtraSuppliedFormatters:j})};return w.resolvedLocale=n,w.strings=r,w.sort=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return O.apply(void 0,[n].concat(t))},w.sortList=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _.apply(void 0,[n].concat(t))},w.list=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return M.apply(void 0,[n].concat(t))},w},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeStringFinder,a=void 0===n?re:n,o=e.localesBasePath,i=e.localeResolver,s=e.localeMatcher,u=e.messageStyle,c=e.allSubstitutions,l=e.insertNodes,f=e.defaults,p=e.substitutions,h=e.maximumLocalNestingDepth,v=e.dom,y=e.forceNodeReturn,g=e.throwOnMissingSuppliedFormatters,d=e.throwOnExtraSuppliedFormatters;try{return oe(a({locales:t,defaultLocales:r,localeResolver:i,localesBasePath:o,localeMatcher:s}),(function(e){var t=e.strings,r=e.locale;return ie({strings:t,resolvedLocale:r,messageStyle:u,allSubstitutions:c,insertNodes:l,defaults:f,substitutions:p,maximumLocalNestingDepth:h,dom:v,forceNodeReturn:y,throwOnMissingSuppliedFormatters:g,throwOnExtraSuppliedFormatters:d})}))}catch(e){return Promise.reject(e)}};export{T as Formatter,L as LocalFormatter,R as RegularFormatter,I as SwitchFormatter,P as defaultAllSubstitutions,J as defaultInsertNodes,ee as defaultLocaleMatcher,H as defaultLocaleResolver,ne as findLocale,re as findLocaleStrings,Q as getDOMForLocaleString,j as getDocument,S as getFetch,te as getMatchingLocale,Z as getMessageForKeyByStyle,G as getStringFromMessageAndDefaults,se as i18n,ie as i18nServer,w as parseJSONExtra,k as processRegex,W as promiseChainForValues,E as setDocument,x as setFetch,m as unescapeBackslashes};
//# sourceMappingURL=index.esm.min.js.map
