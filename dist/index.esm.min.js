function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h,v=(function(e,t){const r=-1,n=0,a=1,i=2,o=3,s=4,u=5,c=6,l=7,f=8,p=9,h=10,v=11,y=13,g=0,d=[];function b(){var e=d.pop();return e||(e={context:g,elements:null,element_array:null}),e}function m(e){d.push(e)}const w=[];function k(e){w.push(e)}var F=t;F.escape=function(e){var t,r="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(r+="\\"),r+=e[t];return r},F.begin=function(e,t){const d={name:null,value_type:n,string:"",contains:null},F={line:1,col:1};let x,D=0;var S=0,E=!0,j=!1,O=null,_=void 0,M=[],P={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},pop(){var e=this.last;return e?((this.last=e.prior)||(this.first=null),e.next=this.saved,this.saved=e,e.node):null}},T=g,A=0,N=!1,L=!1,R=!1,C=!1,I=!1,B={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=this.first,t.prior=null):t={node:e,next:this.first,prior:null},this.first||(this.last=t),this.first=t}},K=null,$=!1,U=!1,q=!1,V=!1,z=!1,W=!1,H=!1,J=0,Z=0,G=!1,Q=!1;return{value(){var e=O;return O=void 0,e},reset(){S=0,E=!0,B.last&&(B.last.next=B.save),B.save=B.first,B.first=B.last=null,P.last&&(P.last.next=P.save),P.save=B.first,P.first=P.last=null,M=null,_=void 0,T=g,d.value_type=n,d.name=null,d.string="",F.line=1,F.col=1,j=!1,A=0,Q=!1,$=!1,q=!1,V=!1},write(r){var n;for("string"!=typeof r&&(r=String(r)),n=this._write(r,!1);n>0&&(O&&("function"==typeof t&&function e(r,n){var a,i,o=r[n];if(o&&"object"==typeof o)for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(void 0!==(i=e(o,a))?o[a]=i:delete o[a]);return t.call(r,n,o)}({"":O},""),e(O),O=void 0),!(n<2));n=this._write());},_write(e,t){var X,Y,ee,te=0;function re(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${D} (near '${ee.substr(D>4?D-4:0,D>4?3:D-1)}[${String.fromCodePoint(t)}]${ee.substr(D,10)}') [${F.line}:${F.col}]`)}function ne(){d.value_type=n,d.string=""}function ae(e){return e.length>1&&!N&&!L&&!R&&48===e.charCodeAt(0)?(j?-1:1)*Number("0o"+e):(j?-1:1)*Number(e)}function ie(){switch(d.value_type){case u:M.push(ae(d.string));break;case s:M.push(d.string);break;case i:M.push(!0);break;case o:M.push(!1);break;case f:case p:M.push(NaN);break;case h:M.push(-1/0);break;case v:M.push(1/0);break;case a:M.push(null);break;case r:M.push(void 0);break;case y:M.push(void 0),delete M[M.length-1];break;case c:case l:M.push(d.contains);break;default:console.log("Unhandled array push.")}}function oe(){switch(d.value_type){case u:_[d.name]=ae(d.string);break;case s:_[d.name]=d.string;break;case i:_[d.name]=!0;break;case o:_[d.name]=!1;break;case f:case p:_[d.name]=NaN;break;case h:_[d.name]=-1/0;break;case v:_[d.name]=1/0;break;case a:_[d.name]=null;break;case r:_[d.name]=void 0;break;case c:case l:_[d.name]=d.contains}}function se(e){let t=0;for(;0==t&&D<ee.length;){x=ee.charAt(D);let r=ee.codePointAt(D++);if(r>=65536&&(x+=ee.charAt(D),D++),F.col++,r==e)q?(d.string+=x,q=!1):(t=-1,G?re("Incomplete Octal sequence",r):H?re("Incomplete hexidecimal sequence",r):W?re("Incomplete unicode sequence",r):z&&re("Incomplete long unicode sequence",r),t=1);else if(q){if(G){if(Z<3&&r>=48&&r<=57){if(J*=8,J+=r-48,3==++Z){d.string+=String.fromCodePoint(J),G=!1,q=!1;continue}continue}if(J>255){re("(escaped character, parsing octal escape val=%d) fault while parsing",r),t=-1;break}d.string+=String.fromCodePoint(J),G=!1,q=!1;continue}if(z){if(125==r){d.string+=String.fromCodePoint(J),z=!1,W=!1,q=!1;continue}if(J*=16,r>=48&&r<=57)J+=r-48;else if(r>=65&&r<=70)J+=r-65+10;else{if(!(r>=97&&r<=102)){re("(escaped character, parsing hex of \\u)",r),t=-1,z=!1,q=!1;continue}J+=r-97+10}continue}if(H||W){if(0===Z&&123===r){z=!0;continue}if(Z<2||W&&Z<4){if(J*=16,r>=48&&r<=57)J+=r-48;else if(r>=65&&r<=70)J+=r-65+10;else{if(!(r>=97&&r<=102)){re(W?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",r),t=-1,H=!1,q=!1;continue}J+=r-97+10}Z++,W?4==Z&&(d.string+=String.fromCodePoint(J),W=!1,q=!1):2==Z&&(d.string+=String.fromCodePoint(J),H=!1,q=!1);continue}}switch(r){case 13:V=!0,F.col=1;continue;case 10:case 2028:case 2029:F.line++;break;case 116:d.string+="\t";break;case 98:d.string+="\b";break;case 110:d.string+="\n";break;case 114:d.string+="\r";break;case 102:d.string+="\f";break;case 48:case 49:case 50:case 51:G=!0,J=r-48,Z=1;continue;case 120:H=!0,Z=0,J=0;continue;case 117:W=!0,Z=0,J=0;continue;default:d.string+=x}q=!1}else if(92===r)q?(d.string+="\\",q=!1):q=!0;else{if(V){if(V=!1,10==r){F.line++,F.col=1,q=!1;continue}F.line++,F.col=1;continue}d.string+=x}}return t}function ue(){let e;for(;(e=D)<ee.length;){x=ee.charAt(e);let r=ee.codePointAt(D++);if(r>=65536&&(re("fault while parsing number;",r),x+=ee.charAt(D),D++),95!=r)if(F.col++,r>=48&&r<=57)R&&(I=!0),d.string+=x;else if(45==r||43==r){if(0!=d.string.length&&(!R||C||I)){E=!1,re("fault while parsing number;",r);break}d.string+=x,C=!0}else if(46==r){if(L||N||R){E=!1,re("fault while parsing number;",r);break}d.string+=x,L=!0}else if(120==r||98==r||111==r||88==r||66==r||79==r){if(N||"0"!=d.string){E=!1,re("fault while parsing number;",r);break}N=!0,d.string+=x}else{if(101!=r&&69!=r){if(32==r||13==r||10==r||9==r||65279==r||44==r||125==r||93==r||58==r)break;t&&(E=!1,re("fault while parsing number;",r));break}if(R){E=!1,re("fault while parsing number;",r);break}d.string+=x,R=!0}}D=e,t||D!=ee.length?(U=!1,d.value_type=u,T==g&&(Q=!0)):U=!0}if(!E)return-1;for(e&&e.length?((Y=function(){var e=w.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=e,B.push(Y)):U&&(U=!1,d.value_type=u,T==g&&(Q=!0),te=1);E&&(Y=B.shift());){if(D=Y.n,ee=Y.buf,$){let e=se(K);e<0?E=!1:e>0&&($=!1,E&&(d.value_type=s))}for(U&&ue();!Q&&E&&D<ee.length;){if(x=ee.charAt(D),(X=ee.codePointAt(D++))>=65536&&(x+=ee.charAt(D),D++),F.col++,A){if(1==A){if(42==X){A=3;continue}47!=X?(re("fault while parsing;",X),E=!1):A=2;continue}if(2==A){if(10==X){A=0;continue}continue}if(3==A){if(42==X){A=4;continue}continue}if(4==A){if(47==X){A=0;continue}42!=X&&(A=3);continue}}switch(X){case 47:A||(A=1);break;case 123:if(29==S||30==S||3==T&&0==S){re("fault while parsing; getting field name unexpected ",X),E=!1;break}{let e=b();d.value_type=c;let t={};T==g?O=_=t:4==T&&(_[d.name]=t),e.context=T,e.elements=_,e.element_array=M,e.name=d.name,_=t,P.push(e),ne(),T=3}break;case 91:if(3==T||29==S||30==S){re("Fault while parsing; while getting field name unexpected",X),E=!1;break}{let e=b();d.value_type=l;let t=[];T==g?O=M=t:4==T&&(_[d.name]=t),e.context=T,e.elements=_,e.element_array=M,e.name=d.name,M=t,P.push(e),ne(),T=1}break;case 58:if(3==T){if(0!=S&&29!=S&&30!=S){E=FALSE,thorwError(`fault while parsing; unquoted keyword used as object field name (state:${S})`,X);break}S=0,d.name=d.string,d.string="",T=4,d.value_type=n}else re(1==T?"(in array, got colon out of string):parsing fault;":"(outside any object, got colon out of string):parsing fault;",X),E=!1;break;case 125:if(31==S&&(S=0),3==T){ne();let e=P.pop();T=e.context,_=e.elements,M=e.element_array,m(e),T==g&&(Q=!0)}else if(4==T){d.value_type!=n&&oe(),d.value_type=c,d.contains=_;var ce=P.pop();d.name=ce.name,T=ce.context,_=ce.elements,M=ce.element_array,m(ce),T==g&&(Q=!0)}else re("Fault while parsing; unexpected",X),E=!1;j=!1;break;case 93:31==S&&(S=0),1==T?(d.value_type!=n&&ie(),d.value_type=l,d.contains=M,ce=P.pop(),d.name=ce.name,T=ce.context,_=ce.elements,M=ce.element_array,m(ce),T==g&&(Q=!0)):(re(`bad context ${T}; fault while parsing`,X),E=!1),j=!1;break;case 44:31==S&&(S=0),1==T?(d.value_type==n&&(d.value_type=y),d.value_type!=n&&(ie(),ne())):4==T?(T=3,d.value_type!=n&&(oe(),ne())):(E=!1,re("bad context; excessive commas while parsing;",X)),j=!1;break;default:if(3==T)switch(X){case 96:case 34:case 39:0==S?se(X)?d.value_type=s:(K=X,$=!0):re("fault while parsing; quote not at start of field name",X);break;case 10:F.line++,F.col=1;case 13:case 32:case 9:case 65279:if(31==S){S=0,T==g&&(Q=!0);break}if(0==S||30==S)break;29==S?S=30:(E=!1,re("fault while parsing; whitepsace unexpected",X));break;default:30==S&&(E=!1,re("fault while parsing; character unexpected",X)),0==S&&(S=29),d.string+=x}else switch(X){case 96:case 34:case 39:se(X)?(d.value_type=s,S=31):(K=X,$=!0);break;case 10:F.line++,F.col=1;case 32:case 9:case 13:case 65279:if(31==S){S=0,T==g&&(Q=!0);break}if(0==S)break;29==S?S=30:(E=!1,re("fault parsing whitespace",X));break;case 116:0==S?S=1:27==S?S=28:(E=!1,re("fault parsing",X));break;case 114:1==S?S=2:(E=!1,re("fault parsing",X));break;case 117:2==S?S=3:9==S?S=10:0==S?S=12:(E=!1,re("fault parsing",X));break;case 101:3==S?(d.value_type=i,S=31):8==S?(d.value_type=o,S=31):14==S?S=15:18==S?S=19:(E=!1,re("fault parsing",X));break;case 110:0==S?S=9:12==S?S=13:17==S?S=18:22==S?S=23:25==S?S=26:(E=!1,re("fault parsing",X));break;case 100:13==S?S=14:19==S?(d.value_type=r,S=31):(E=!1,re("fault parsing",X));break;case 105:16==S?S=17:24==S?S=25:26==S?S=27:(E=!1,re("fault parsing",X));break;case 108:10==S?S=11:11==S?(d.value_type=a,S=31):6==S?S=7:(E=!1,re("fault parsing",X));break;case 102:0==S?S=5:15==S?S=16:23==S?S=24:(E=!1,re("fault parsing",X));break;case 97:5==S?S=6:20==S?S=21:(E=!1,re("fault parsing",X));break;case 115:7==S?S=8:(E=!1,re("fault parsing",X));break;case 73:0==S?S=22:(E=!1,re("fault parsing",X));break;case 78:0==S?S=20:21==S?(d.value_type=j?f:p,j=!1,S=31):(E=!1,re("fault parsing",X));break;case 121:28==S?(d.value_type=j?h:v,j=!1,S=31):(E=!1,re("fault parsing",X));break;case 45:0==S?j=!j:(E=!1,re("fault parsing",X));break;default:X>=48&&X<=57||43==X||46==X||45==X?(N=!1,R=!1,C=!1,I=!1,L=!1,d.string=x,Y.n=D,ue()):(E=!1,re("fault parsing",X))}}if(Q){31==S&&(S=0);break}}if(D==ee.length?(k(Y),$||U||3==T?te=0:T!=g||d.value_type==n&&!O||(Q=!0,te=1)):(Y.n=D,B.unshift(Y),te=2),Q)break}if(!E)return-1;if(Q&&d.value_type!=n){switch(d.value_type){case u:O=ae(d.string);break;case s:O=d.string;break;case i:O=!0;break;case o:O=!1;break;case a:O=null;break;case r:O=void 0;break;case p:case f:O=NaN;break;case v:O=1/0;break;case h:O=-1/0;break;case c:case l:O=d.contains}j=!1,d.string="",d.value_type=n}return Q=!1,te}}};const x=[Object.freeze(F.begin())];var D=0;F.parse=function(e,t){var r,n=D++;if(x.length<=n&&x.push(Object.freeze(F.begin())),r=x[n],"string"!=typeof e&&(e=String(e)),r.reset(),r._write(e,!0)>0){var a=r.value();return"function"==typeof t&&function e(r,n){var a,i,o=r[n];if(o&&"object"==typeof o)for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(void 0!==(i=e(o,a))?o[a]=i:delete o[a]);return t.call(r,n,o)}({"":a},""),D--,a}},F.stringify=JSON.stringify}(h={exports:{}},h.exports),h.exports),y=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},g=function(e){return v.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},d=function(e,t,r){var n,a=r.onMatch,i=r.extra,o=r.betweenMatches,s=r.afterMatch,u=r.escapeAtOne,c=0;for(i&&(o=i,s=i,u=i);null!==(n=e.exec(t));){var l=f(n,2),h=l[0],v=l[1],y=e.lastIndex,g=y-h.length;g>c&&o(t.slice(c,g)),u&&v.length%2?(c=y,u(h)):(a.apply(void 0,p(n)),c=y)}c!==t.length&&s(t.slice(c))};var b=function(e,t,r){return t.sort(new Intl.Collator(e,r).compare)},m=function(e,t,r){return new Intl.ListFormat(e,r).format(t)},w=function(e,t,r,n,a){if("function"!=typeof r)return function(e,t,r,n){return b(e,t,n),m(e,t,r)}(e,t,r,n);b(e,t,a);var i,o=(i=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(i+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"===e?t:3&t|8).toString(16)}))),s=p(t).map((function(e,t){return"<<".concat(o).concat(t,">>")})),u=[],c=function(){u.push.apply(u,arguments)};d(new RegExp("<<".concat(o,"(\\d)>>"),"gu"),m(e,s,n),{betweenMatches:c,afterMatch:c,onMatch:function(e,n){c(r(t[n],n))}});var l=document.createDocumentFragment();return l.append.apply(l,u),l},k=function(e){var t=e.object;if(Array.isArray(t)){if("function"==typeof t[1]){var r=f(t,4);return{value:r[0],callback:r[1],options:r[2],extraOpts:r[3]}}var n=f(t,3);return{value:n[0],options:n[1],extraOpts:n[2]}}return{value:t}},F=function(t){var r,n=t.value,a=t.arg,i=(t.key,t.locale);if("string"==typeof n||n&&"object"===e(n)&&"nodeType"in n)return n;var s=function(e){var t=e.type,n=e.options,i=void 0===n?r:n,s=e.checkArgOptions,u=void 0!==s&&s;if("string"==typeof a){var c=f(a.split("|"),3),l=c[0],p=c[1],h=c[2];"DATE"===l&&(l="DATETIME"),l===t&&(p?u&&!h||(i=o({},i,{},g(u&&h?h:p))):i={})}return i};if(n&&"object"===e(n)){var u=Object.keys(n)[0];if(["number","date","datetime","relative","list","plural"].includes(u)){var c,l,p=k({object:n[u]});switch(n=p.value,r=p.options,c=p.extraOpts,l=p.callback,u){case"relative":var h=[r,c];return c=h[0],r=h[1],new Intl.RelativeTimeFormat(i,s({type:"RELATIVE"})).format(n,c);case"list":return l?w(i,n,l,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0})):w(i,n,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0}))}}}if("number"==typeof n)return new Intl.NumberFormat(i,s({type:"NUMBER"})).format(n);if(n&&"object"===e(n)&&"function"==typeof n.getTime)return new Intl.DateTimeFormat(i,s({type:"DATETIME"})).format(n);throw new TypeError("Unknown formatter")},x=function e(){t(this,e)},D=function(e){var t=e.key,r=e.body,n=e.type,a=e.messageStyle,i=B({messageStyle:void 0===a?"richNested":a})({body:r},t);if(!i)throw new Error("Key value not found for ".concat(n," key: (").concat(t,")"));return i.value},S=function(e){function r(e){var n;return t(this,r),(n=l(this,u(r).call(this))).locals=e,n}return s(r,x),n(r,[{key:"getSubstitution",value:function(e){return D({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),r=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in r;return r=r[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),r}(),E=function(e){function r(e){var n;return t(this,r),(n=l(this,u(r).call(this))).substitutions=e,n}return s(r,x),n(r,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),r}(),j=function(r){function a(e,r){var n,i=r.substitutions;return t(this,a),(n=l(this,u(a).call(this))).switches=e,n.substitutions=i,n}return s(a,x),n(a,[{key:"getSubstitution",value:function(t,r){var n,a,i=r.locale,s=r.usedKeys,u=r.arg,c=r.missingSuppliedFormatters,l=this.constructor.getKey(t).slice(1),p=f(this.getMatch(l),3),h=p[0],v=p[1],y=p[2];if(s.push(y),h&&h.includes("|")){var d=f(h.split("|"),3);n=d[1],a=d[2]}if(!v)return c({key:t,formatter:this}),"\\{"+t+"}";var b=function(e,t){var r=g(a);return new Intl.NumberFormat(i,o({},t,{},r)).format(e)},m=function(e,t){var r=g(a);return new Intl.PluralRules(i,o({},t,{},r)).select(e)},w=this.substitutions[y],F=w;if("number"==typeof w)switch(n){case"NUMBER":F=b(w);break;case"PLURAL":F=m(w);break;default:F=new Intl.PluralRules(i).select(w)}else if(w&&"object"===e(w)){var x=Object.keys(w)[0];if(["number","plural"].includes(x)){var S=k({object:w[x]}),E=S.value,j=S.options;if(n||(n=x.toUpperCase()),!(x.toUpperCase()===n))throw new TypeError('Expecting type "'.concat(n.toLowerCase(),'"; instead found "').concat(x,'".'));switch(n){case"NUMBER":F=b(E,j);break;case"PLURAL":F=m(E,j)}}}var O=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return D({messageStyle:"richNested",key:F?O(F):u,body:v,type:"switch"})}catch(e){try{return D({messageStyle:"richNested",key:"*"+O(F),body:v,type:"switch"})}catch(e){var _=Object.keys(v).find((function(e){return e.startsWith("*")}));if(!_)throw new Error("No defaults found for switch ".concat(l));return D({messageStyle:"richNested",key:O(_),body:v,type:"switch"})}}}},{key:"isMatch",value:function(e){return e&&this.constructor.isMatchingKey(e)&&this.getMatch(e.slice(1)).length}},{key:"getMatch",value:function(e){var t=this,r=e.split(".");return r.reduce((function(n,a,i){if(i<r.length-1){if(!(a in n))throw new Error('Switch key "'.concat(a,'" not found (from ').concat(e,")"));return n[a]}var o=Object.entries(n).find((function(e){var r=f(e,1)[0];return a===t.constructor.getKey(r)}));return o?o.concat(a):[]}),this.switches)}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:[\0-\{\}-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/);return t&&t[0]}}]),a}();function O(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function _(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function M(e,t,r){if(!e.s){if(r instanceof P){if(!r.s)return void(r.o=M.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(M.bind(null,e,t),M.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var P=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,a=this.s;if(a){var i=1&a?t:r;if(i){try{M(n,1,i(this.v))}catch(e){M(n,2,e)}return n}return this}return this.o=function(e){try{var a=e.v;1&e.s?M(n,1,t?t(a):a):r?M(n,1,r(a)):M(n,2,a)}catch(e){M(n,2,e)}},n},e}();function T(e){return e instanceof P&&1&e.s}function A(e,t,r){for(var n;;){var a=e();if(T(a)&&(a=a.v),!a)return i;if(a.then){n=0;break}var i=r();if(i&&i.then){if(!T(i)){n=1;break}i=i.s}if(t){var o=t();if(o&&o.then&&!T(o)){n=2;break}}}var s=new P,u=M.bind(null,s,2);return(0===n?a.then(l):1===n?i.then(c):o.then(f)).then(void 0,u),s;function c(n){i=n;do{if(t&&(o=t())&&o.then&&!T(o))return void o.then(f).then(void 0,u);if(!(a=e())||T(a)&&!a.v)return void M(s,1,i);if(a.then)return void a.then(l).then(void 0,u);T(i=r())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,u)}function l(e){e?(i=r())&&i.then?i.then(c).then(void 0,u):c(i):M(s,1,i)}function f(){(a=e())?a.then?a.then(l).then(void 0,u):l(a):M(s,1,i)}}function N(e,t){return e&&e.then?e.then(t):t(e)}function L(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var R=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return L((function(){var n,a,i=!1,o=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return N(A((function(){return!i}),void 0,(function(){var s=e.shift();return _((function(){return O(o,(function(e){n=e,i=!0}))}),(function(){if(a)throw new Error(r);e.length||(a=!0),o=t(s)}))})),(function(e){return n}))}))()},C=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");if(/[\.\/\\]/.test(t))throw new TypeError("Locales cannot use file-reserved characters, `.`, `/` or `\\`");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},I=function(t){var r=t.string,n=t.dom,a=t.usedKeys,i=t.substitutions,s=t.allSubstitutions,u=t.locale,c=t.locals,l=t.switches,f=t.maximumLocalNestingDepth,h=void 0===f?3:f,v=t.missingSuppliedFormatters,b=t.checkExtraSuppliedFormatters;if("number"!=typeof h)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var m=new S(c),w=new E(i),k=new j(l,{substitutions:i}),x=/(\\*)\{((?:(?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\\\})*?)(?:(\|)((?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*))?\}/g;s&&(s=Array.isArray(s)?s:[s]);var D=function(e){var t,r=e.key,n=e.arg,i=e.substs;return m.constructor.isMatchingKey(r)?t=m.getSubstitution(r):k.constructor.isMatchingKey(r)?t=k.getSubstitution(r,{locale:u,usedKeys:a,arg:n,missingSuppliedFormatters:v}):"function"==typeof(t=i[r])&&(t=t({arg:n,key:r})),s?t=s.reduce((function(e,t){return t({value:e,arg:n,key:r,locale:u})}),t):n&&n.match(/^(?:NUMBER|DATE(?:TIME)?|RELATIVE|LIST)(?:\||$)/)&&(t=F({value:t,arg:n,key:r,locale:u})),t},O=1,_=function(e){var t=e.substitution,r=e.ky,n=e.arg,a=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(O++>h)throw new TypeError("Too much recursion in local variables.");if(m.constructor.isMatchingKey(r)){var s,u=i;n&&(s=g(n),u=o({},i,{},s)),t=a({str:t,substs:u,formatter:m}),s&&b({substitutions:s})}else k.constructor.isMatchingKey(r)&&(t=a({str:t}))}return t};if(!n){var M=!1,P=function t(r){var n=r.str,o=r.substs,s=void 0===o?i:o,u=r.formatter,c=void 0===u?w:u;return n.replace(x,(function(r,n,i,o,u){if(n.length%2)return r;if(v({key:i,formatter:c}))return r;var l=D({key:i,arg:u,substs:s});return l=_({substitution:l,ky:i,arg:u,processSubsts:t}),M=M||l&&"object"===e(l)&&"nodeType"in l,a.push(i),n+l}))}({str:r});if(!M)return b({substitutions:i}),a.length=0,y(P);a.length=0}O=1;var T=function t(r){var n=r.str,o=r.substs,s=void 0===o?i:o,u=r.formatter,c=void 0===u?w:u,l=[],f=new RegExp(x,"gu"),h=function(){l.push.apply(l,arguments)};return d(f,n,{extra:h,onMatch:function(r,n,i,o,u){if(v({key:i,formatter:c}))h(r);else{n.length&&h(n);var l=D({key:i,arg:u,substs:s});l=_({substitution:l,ky:i,arg:u,processSubsts:t}),Array.isArray(l)?h.apply(void 0,p(l)):l&&"object"===e(l)&&"nodeType"in l?h(l.cloneNode(!0)):h(l)}a.push(i)}}),l}({str:r});return b({substitutions:i}),a.length=0,T.map((function(e){return"string"==typeof e?y(e):e}))},B=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.messageStyle,n=void 0===r?"richNested":r;return"function"==typeof n?n:"richNested"===n?function(t,r){var n=t&&"object"===e(t)&&t.body,a=[],i=function(e){a.length||(a[0]=""),a[a.length-1]+=e};d(/(\\*)\./g,r,{extra:i,onMatch:function(e,t){i(t),a.push("")}});var o=a.map((function(e){return y(e)})),s=!1,u=n;return o.some((function(t,r,n){return!u||"object"!==e(u)||(r===n.length-1&&t in u&&u[t]&&"object"===e(u[t])&&"message"in u[t]&&"string"==typeof u[t].message&&(s={value:u[t].message,info:u[t]}),u=u[t],!1)})),s}:"rich"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"object"===e(n[r])&&"message"in n[r]&&"string"==typeof n[r].message)&&{value:n[r].message,info:n[r]}}:"plain"===n?function(t,r){var n=t&&"object"===e(t)&&t.body;return!!(n&&"object"===e(n)&&r in n&&n[r]&&"string"==typeof n[r])&&{value:n[r]}}:function(){throw new TypeError("Unknown `messageStyle` ".concat(n))}()},K=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.message,a=r.defaults,i=r.messageStyle,o=r.messageForKey,s=void 0===o?B({messageStyle:i}):o,u=r.key;if("string"!=typeof u)throw new TypeError("An options object with a `key` string is expected on `getStringFromMessageAndDefaults`");if("string"==typeof n)t=n;else if(!1===a||null==a)t=!1;else{if(!a||"object"!==e(a))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(t=s({body:a},u))&&(t=t.value)}if(!1===t)throw new Error("Key value not found for key: (".concat(u,")"));return t},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,r=e.locale,n=e.locals,a=e.switches,i=(e.maximumLocalNestingDepth,e.allSubstitutions),o=void 0===i?[F]:i,s=e.insertNodes,u=void 0===s?I:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,h=void 0!==f&&f,v=e.forceNodeReturn,y=void 0!==v&&v,g=e.throwOnMissingSuppliedFormatters,d=void 0===g||g,b=e.throwOnExtraSuppliedFormatters,m=void 0===b||b;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var w=function(e){return y?document.createTextNode(e):e},k=[],x=function(e){var t=e.substitutions;m&&Object.keys(t).forEach((function(e){if(!k.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},D=function(e){var t=e.key,r=e.formatter,n=r.isMatch(t);if(r.constructor.isMatchingKey(t)&&!n){if(d)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!o&&!d)return w(t);l||(l={});var S=u({string:t,dom:h,usedKeys:k,substitutions:l,allSubstitutions:o,locale:r,locals:n,switches:a,missingSuppliedFormatters:D,checkExtraSuppliedFormatters:x});if("string"==typeof S)return w(S);var E=document.createDocumentFragment();return E.append.apply(E,p(S)),E};function U(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function q(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var V=function(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:[\0-,\.-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*$/,"")},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,a=e.localesBasePath,i=e.localeMatcher;return H({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:a,localeMatcher:i})},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,a=e.localesBasePath,i=e.localeMatcher;return H({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:a,localeMatcher:i,headOnly:!0})},H=q((function(e){var t=q((function(e){if("string"!=typeof e)throw new TypeError("Non-string locale type");var r=s(c,e);if("string"!=typeof r)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}((function(){return U(v?fetch(r,{method:"HEAD"}):fetch(r),(function(t){if(404===t.status)throw new Error("Trying again");return v?e:U(t.json(),(function(t){return{locale:e,strings:t}}))}))}),(function(r){if("SyntaxError"===r.name)throw r;return U(f(e),t)}))})),r=e.locales,n=void 0===r?"undefined"!=typeof intlDomLocale?[intlDomLocale]:"undefined"==typeof navigator?[]:navigator.languages:r,a=e.defaultLocales,i=void 0===a?["en-US"]:a,o=e.localeResolver,s=void 0===o?C:o,u=e.localesBasePath,c=void 0===u?".":u,l=e.localeMatcher,f=void 0===l?"lookup":l,h=e.headOnly,v=void 0!==h&&h;if("lookup"===f)f=V;else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return R([].concat(p(n),p(i)),t,"No matching locale found!")}));function J(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var Z=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.locales,n=t.defaultLocales,a=t.localeStringFinder,i=void 0===a?z:a,s=t.localesBasePath,u=t.localeResolver,c=t.localeMatcher,l=t.messageStyle,f=t.allSubstitutions,p=t.insertNodes,h=t.defaults,v=t.substitutions,y=t.maximumLocalNestingDepth,g=t.dom,d=void 0!==g&&g,m=t.forceNodeReturn,k=void 0!==m&&m,F=t.throwOnMissingSuppliedFormatters,x=void 0===F||F,D=t.throwOnExtraSuppliedFormatters,S=void 0===D||D;try{return J(i({locales:r,defaultLocales:n,localeResolver:u,localesBasePath:s,localeMatcher:c}),(function(t){var r=t.strings,n=t.locale;if(!r||"object"!==e(r))throw new TypeError("Locale strings must be an object!");var a=B({messageStyle:l}),i=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.allSubstitutions,u=void 0===s?f:s,c=i.defaults,l=void 0===c?h:c,g=i.dom,b=void 0===g?d:g,m=i.forceNodeReturn,w=void 0===m?k:m,F=i.throwOnMissingSuppliedFormatters,D=void 0===F?x:F,E=i.throwOnExtraSuppliedFormatters,j=void 0===E?S:E,O=a(r,e),_=K({message:O&&O.value||!1,defaults:l,messageForKey:a,key:e});return $({string:_,locals:r.head&&r.head.locals,switches:r.head&&r.head.switches,locale:n,maximumLocalNestingDepth:y,allSubstitutions:u,insertNodes:p,substitutions:o({},v,{},t),dom:b,forceNodeReturn:w,throwOnMissingSuppliedFormatters:D,throwOnExtraSuppliedFormatters:j})};return i.resolvedLocale=n,i.strings=r,i.sort=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return b.apply(void 0,[n].concat(t))},i.sortList=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return w.apply(void 0,[n].concat(t))},i}))}catch(e){return Promise.reject(e)}};export{x as Formatter,S as LocalFormatter,E as RegularFormatter,j as SwitchFormatter,F as defaultAllSubstitutions,I as defaultInsertNodes,V as defaultLocaleMatcher,C as defaultLocaleResolver,W as findLocale,z as findLocaleStrings,$ as getDOMForLocaleString,B as getMessageForKeyByStyle,K as getStringFromMessageAndDefaults,Z as i18n,g as parseJSONExtra,d as processRegex,R as promiseChainForValues,y as unescapeBackslashes};
//# sourceMappingURL=index.esm.min.js.map
