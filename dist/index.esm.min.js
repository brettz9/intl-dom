function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h,v=(function(e,t){const n=-1,r=0,i=1,a=2,o=3,s=4,u=5,c=6,l=7,f=8,p=9,h=10,v=11,g=13,y=0,b=[];function d(){var e=b.pop();return e||(e={context:y,elements:null,element_array:null}),e}function m(e){b.push(e)}const w=[];function k(e){w.push(e)}var F=t;F.escape=function(e){var t,n="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(n+="\\"),n+=e[t];return n},F.begin=function(e,t){const b={name:null,value_type:r,string:"",contains:null},F={line:1,col:1};let x,S=0;var D=0,j=!0,E=!1,O=null,_=void 0,M=[],T={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},pop(){var e=this.last;return e?((this.last=e.prior)||(this.first=null),e.next=this.saved,this.saved=e,e.node):null}},A=y,P=0,N=!1,L=!1,C=!1,I=!1,R=!1,K={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=this.first,t.prior=null):t={node:e,next:this.first,prior:null},this.first||(this.last=t),this.first=t}},B=null,$=!1,U=!1,q=!1,V=!1,z=!1,W=!1,J=!1,Z=0,G=0,H=!1,Q=!1;return{value(){var e=O;return O=void 0,e},reset(){D=0,j=!0,K.last&&(K.last.next=K.save),K.save=K.first,K.first=K.last=null,T.last&&(T.last.next=T.save),T.save=K.first,T.first=T.last=null,M=null,_=void 0,A=y,b.value_type=r,b.name=null,b.string="",F.line=1,F.col=1,E=!1,P=0,Q=!1,$=!1,q=!1,V=!1},write(n){var r;for("string"!=typeof n&&(n=String(n)),r=this._write(n,!1);r>0&&(O&&("function"==typeof t&&function e(n,r){var i,a,o=n[r];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(a=e(o,i))?o[i]=a:delete o[i]);return t.call(n,r,o)}({"":O},""),e(O),O=void 0),!(r<2));r=this._write());},_write(e,t){var X,Y,ee,te=0;function ne(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${S} (near '${ee.substr(S>4?S-4:0,S>4?3:S-1)}[${String.fromCodePoint(t)}]${ee.substr(S,10)}') [${F.line}:${F.col}]`)}function re(){b.value_type=r,b.string=""}function ie(e){return e.length>1&&!N&&!L&&!C&&48===e.charCodeAt(0)?(E?-1:1)*Number("0o"+e):(E?-1:1)*Number(e)}function ae(){switch(b.value_type){case u:M.push(ie(b.string));break;case s:M.push(b.string);break;case a:M.push(!0);break;case o:M.push(!1);break;case f:case p:M.push(NaN);break;case h:M.push(-1/0);break;case v:M.push(1/0);break;case i:M.push(null);break;case n:M.push(void 0);break;case g:M.push(void 0),delete M[M.length-1];break;case c:case l:M.push(b.contains);break;default:console.log("Unhandled array push.")}}function oe(){switch(b.value_type){case u:_[b.name]=ie(b.string);break;case s:_[b.name]=b.string;break;case a:_[b.name]=!0;break;case o:_[b.name]=!1;break;case f:case p:_[b.name]=NaN;break;case h:_[b.name]=-1/0;break;case v:_[b.name]=1/0;break;case i:_[b.name]=null;break;case n:_[b.name]=void 0;break;case c:case l:_[b.name]=b.contains}}function se(e){let t=0;for(;0==t&&S<ee.length;){x=ee.charAt(S);let n=ee.codePointAt(S++);if(n>=65536&&(x+=ee.charAt(S),S++),F.col++,n==e)q?(b.string+=x,q=!1):(t=-1,H?ne("Incomplete Octal sequence",n):J?ne("Incomplete hexidecimal sequence",n):W?ne("Incomplete unicode sequence",n):z&&ne("Incomplete long unicode sequence",n),t=1);else if(q){if(H){if(G<3&&n>=48&&n<=57){if(Z*=8,Z+=n-48,3==++G){b.string+=String.fromCodePoint(Z),H=!1,q=!1;continue}continue}if(Z>255){ne("(escaped character, parsing octal escape val=%d) fault while parsing",n),t=-1;break}b.string+=String.fromCodePoint(Z),H=!1,q=!1;continue}if(z){if(125==n){b.string+=String.fromCodePoint(Z),z=!1,W=!1,q=!1;continue}if(Z*=16,n>=48&&n<=57)Z+=n-48;else if(n>=65&&n<=70)Z+=n-65+10;else{if(!(n>=97&&n<=102)){ne("(escaped character, parsing hex of \\u)",n),t=-1,z=!1,q=!1;continue}Z+=n-97+10}continue}if(J||W){if(0===G&&123===n){z=!0;continue}if(G<2||W&&G<4){if(Z*=16,n>=48&&n<=57)Z+=n-48;else if(n>=65&&n<=70)Z+=n-65+10;else{if(!(n>=97&&n<=102)){ne(W?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",n),t=-1,J=!1,q=!1;continue}Z+=n-97+10}G++,W?4==G&&(b.string+=String.fromCodePoint(Z),W=!1,q=!1):2==G&&(b.string+=String.fromCodePoint(Z),J=!1,q=!1);continue}}switch(n){case 13:V=!0,F.col=1;continue;case 10:case 2028:case 2029:F.line++;break;case 116:b.string+="\t";break;case 98:b.string+="\b";break;case 110:b.string+="\n";break;case 114:b.string+="\r";break;case 102:b.string+="\f";break;case 48:case 49:case 50:case 51:H=!0,Z=n-48,G=1;continue;case 120:J=!0,G=0,Z=0;continue;case 117:W=!0,G=0,Z=0;continue;default:b.string+=x}q=!1}else if(92===n)q?(b.string+="\\",q=!1):q=!0;else{if(V){if(V=!1,10==n){F.line++,F.col=1,q=!1;continue}F.line++,F.col=1;continue}b.string+=x}}return t}function ue(){let e;for(;(e=S)<ee.length;){x=ee.charAt(e);let n=ee.codePointAt(S++);if(n>=65536&&(ne("fault while parsing number;",n),x+=ee.charAt(S),S++),95!=n)if(F.col++,n>=48&&n<=57)C&&(R=!0),b.string+=x;else if(45==n||43==n){if(0!=b.string.length&&(!C||I||R)){j=!1,ne("fault while parsing number;",n);break}b.string+=x,I=!0}else if(46==n){if(L||N||C){j=!1,ne("fault while parsing number;",n);break}b.string+=x,L=!0}else if(120==n||98==n||111==n||88==n||66==n||79==n){if(N||"0"!=b.string){j=!1,ne("fault while parsing number;",n);break}N=!0,b.string+=x}else{if(101!=n&&69!=n){if(32==n||13==n||10==n||9==n||65279==n||44==n||125==n||93==n||58==n)break;t&&(j=!1,ne("fault while parsing number;",n));break}if(C){j=!1,ne("fault while parsing number;",n);break}b.string+=x,C=!0}}S=e,t||S!=ee.length?(U=!1,b.value_type=u,A==y&&(Q=!0)):U=!0}if(!j)return-1;for(e&&e.length?((Y=function(){var e=w.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=e,K.push(Y)):U&&(U=!1,b.value_type=u,A==y&&(Q=!0),te=1);j&&(Y=K.shift());){if(S=Y.n,ee=Y.buf,$){let e=se(B);e<0?j=!1:e>0&&($=!1,j&&(b.value_type=s))}for(U&&ue();!Q&&j&&S<ee.length;){if(x=ee.charAt(S),(X=ee.codePointAt(S++))>=65536&&(x+=ee.charAt(S),S++),F.col++,P){if(1==P){if(42==X){P=3;continue}47!=X?(ne("fault while parsing;",X),j=!1):P=2;continue}if(2==P){if(10==X){P=0;continue}continue}if(3==P){if(42==X){P=4;continue}continue}if(4==P){if(47==X){P=0;continue}42!=X&&(P=3);continue}}switch(X){case 47:P||(P=1);break;case 123:if(29==D||30==D||3==A&&0==D){ne("fault while parsing; getting field name unexpected ",X),j=!1;break}{let e=d();b.value_type=c;let t={};A==y?O=_=t:4==A&&(_[b.name]=t),e.context=A,e.elements=_,e.element_array=M,e.name=b.name,_=t,T.push(e),re(),A=3}break;case 91:if(3==A||29==D||30==D){ne("Fault while parsing; while getting field name unexpected",X),j=!1;break}{let e=d();b.value_type=l;let t=[];A==y?O=M=t:4==A&&(_[b.name]=t),e.context=A,e.elements=_,e.element_array=M,e.name=b.name,M=t,T.push(e),re(),A=1}break;case 58:if(3==A){if(0!=D&&29!=D&&30!=D){j=FALSE,thorwError(`fault while parsing; unquoted keyword used as object field name (state:${D})`,X);break}D=0,b.name=b.string,b.string="",A=4,b.value_type=r}else ne(1==A?"(in array, got colon out of string):parsing fault;":"(outside any object, got colon out of string):parsing fault;",X),j=!1;break;case 125:if(31==D&&(D=0),3==A){re();let e=T.pop();A=e.context,_=e.elements,M=e.element_array,m(e),A==y&&(Q=!0)}else if(4==A){b.value_type!=r&&oe(),b.value_type=c,b.contains=_;var ce=T.pop();b.name=ce.name,A=ce.context,_=ce.elements,M=ce.element_array,m(ce),A==y&&(Q=!0)}else ne("Fault while parsing; unexpected",X),j=!1;E=!1;break;case 93:31==D&&(D=0),1==A?(b.value_type!=r&&ae(),b.value_type=l,b.contains=M,ce=T.pop(),b.name=ce.name,A=ce.context,_=ce.elements,M=ce.element_array,m(ce),A==y&&(Q=!0)):(ne(`bad context ${A}; fault while parsing`,X),j=!1),E=!1;break;case 44:31==D&&(D=0),1==A?(b.value_type==r&&(b.value_type=g),b.value_type!=r&&(ae(),re())):4==A?(A=3,b.value_type!=r&&(oe(),re())):(j=!1,ne("bad context; excessive commas while parsing;",X)),E=!1;break;default:if(3==A)switch(X){case 96:case 34:case 39:0==D?se(X)?b.value_type=s:(B=X,$=!0):ne("fault while parsing; quote not at start of field name",X);break;case 10:F.line++,F.col=1;case 13:case 32:case 9:case 65279:if(31==D){D=0,A==y&&(Q=!0);break}if(0==D||30==D)break;29==D?D=30:(j=!1,ne("fault while parsing; whitepsace unexpected",X));break;default:30==D&&(j=!1,ne("fault while parsing; character unexpected",X)),0==D&&(D=29),b.string+=x}else switch(X){case 96:case 34:case 39:se(X)?(b.value_type=s,D=31):(B=X,$=!0);break;case 10:F.line++,F.col=1;case 32:case 9:case 13:case 65279:if(31==D){D=0,A==y&&(Q=!0);break}if(0==D)break;29==D?D=30:(j=!1,ne("fault parsing whitespace",X));break;case 116:0==D?D=1:27==D?D=28:(j=!1,ne("fault parsing",X));break;case 114:1==D?D=2:(j=!1,ne("fault parsing",X));break;case 117:2==D?D=3:9==D?D=10:0==D?D=12:(j=!1,ne("fault parsing",X));break;case 101:3==D?(b.value_type=a,D=31):8==D?(b.value_type=o,D=31):14==D?D=15:18==D?D=19:(j=!1,ne("fault parsing",X));break;case 110:0==D?D=9:12==D?D=13:17==D?D=18:22==D?D=23:25==D?D=26:(j=!1,ne("fault parsing",X));break;case 100:13==D?D=14:19==D?(b.value_type=n,D=31):(j=!1,ne("fault parsing",X));break;case 105:16==D?D=17:24==D?D=25:26==D?D=27:(j=!1,ne("fault parsing",X));break;case 108:10==D?D=11:11==D?(b.value_type=i,D=31):6==D?D=7:(j=!1,ne("fault parsing",X));break;case 102:0==D?D=5:15==D?D=16:23==D?D=24:(j=!1,ne("fault parsing",X));break;case 97:5==D?D=6:20==D?D=21:(j=!1,ne("fault parsing",X));break;case 115:7==D?D=8:(j=!1,ne("fault parsing",X));break;case 73:0==D?D=22:(j=!1,ne("fault parsing",X));break;case 78:0==D?D=20:21==D?(b.value_type=E?f:p,E=!1,D=31):(j=!1,ne("fault parsing",X));break;case 121:28==D?(b.value_type=E?h:v,E=!1,D=31):(j=!1,ne("fault parsing",X));break;case 45:0==D?E=!E:(j=!1,ne("fault parsing",X));break;default:X>=48&&X<=57||43==X||46==X||45==X?(N=!1,C=!1,I=!1,R=!1,L=!1,b.string=x,Y.n=S,ue()):(j=!1,ne("fault parsing",X))}}if(Q){31==D&&(D=0);break}}if(S==ee.length?(k(Y),$||U||3==A?te=0:A!=y||b.value_type==r&&!O||(Q=!0,te=1)):(Y.n=S,K.unshift(Y),te=2),Q)break}if(!j)return-1;if(Q&&b.value_type!=r){switch(b.value_type){case u:O=ie(b.string);break;case s:O=b.string;break;case a:O=!0;break;case o:O=!1;break;case i:O=null;break;case n:O=void 0;break;case p:case f:O=NaN;break;case v:O=1/0;break;case h:O=-1/0;break;case c:case l:O=b.contains}E=!1,b.string="",b.value_type=r}return Q=!1,te}}};const x=[Object.freeze(F.begin())];var S=0;F.parse=function(e,t){var n,r=S++;if(x.length<=r&&x.push(Object.freeze(F.begin())),n=x[r],"string"!=typeof e&&(e=String(e)),n.reset(),n._write(e,!0)>0){var i=n.value();return"function"==typeof t&&function e(n,r){var i,a,o=n[r];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(void 0!==(a=e(o,i))?o[i]=a:delete o[i]);return t.call(n,r,o)}({"":i},""),S--,i}},F.stringify=JSON.stringify}(h={exports:{}},h.exports),h.exports),g=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},y=function(e){return v.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},b=function(e,t,n){var r,i=n.onMatch,a=n.extra,o=n.betweenMatches,s=n.afterMatch,u=n.escapeAtOne,c=0;for(a&&(o=a,s=a,u=a);null!==(r=e.exec(t));){var l=f(r,2),h=l[0],v=l[1],g=e.lastIndex,y=g-h.length;y>c&&o(t.slice(c,y)),u&&v.length%2?(c=g,u(h)):(i.apply(void 0,p(r)),c=g)}c!==t.length&&s(t.slice(c))};var d=function(e,t,n){return t.sort(new Intl.Collator(e,n).compare)},m=function(e,t,n){return new Intl.ListFormat(e,n).format(t)},w=function(e,t,n,r,i){if("function"!=typeof n)return function(e,t,n,r){return d(e,t,r),m(e,t,n)}(e,t,n,r);d(e,t,i);var a,o=(a=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(a+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===e?t:3&t|8).toString(16)}))),s=p(t).map((function(e,t){return"<<".concat(o).concat(t,">>")})),u=[],c=function(){u.push.apply(u,arguments)};b(new RegExp("<<".concat(o,"(\\d)>>"),"gu"),m(e,s,r),{betweenMatches:c,afterMatch:c,onMatch:function(e,r){c(n(t[r],r))}});var l=document.createDocumentFragment();return l.append.apply(l,u),l},k=function(e){var t=e.object;if(Array.isArray(t)){if("function"==typeof t[1]){var n=f(t,4);return{value:n[0],callback:n[1],options:n[2],extraOpts:n[3]}}var r=f(t,3);return{value:r[0],options:r[1],extraOpts:r[2]}}return{value:t}},F=function(t){var n,r=t.value,i=t.arg,a=(t.key,t.locale);if("string"==typeof r||r&&"object"===e(r)&&"nodeType"in r)return r;var s=function(e){var t=e.type,r=e.options,a=void 0===r?n:r,s=e.checkArgOptions,u=void 0!==s&&s;if("string"==typeof i){var c=f(i.split("|"),3),l=c[0],p=c[1],h=c[2];"DATE"===l&&(l="DATETIME"),l===t&&(p?u&&!h||(a=o({},a,{},y(u&&h?h:p))):a={})}return a};if(r&&"object"===e(r)){var u=Object.keys(r)[0];if(["number","date","datetime","relative","list","plural"].includes(u)){var c,l,p=k({object:r[u]});switch(r=p.value,n=p.options,c=p.extraOpts,l=p.callback,u){case"relative":var h=[n,c];return c=h[0],n=h[1],new Intl.RelativeTimeFormat(a,s({type:"RELATIVE"})).format(r,c);case"list":return l?w(a,r,l,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0})):w(a,r,s({type:"LIST"}),s({type:"LIST",options:c,checkArgOptions:!0}))}}}if("number"==typeof r)return new Intl.NumberFormat(a,s({type:"NUMBER"})).format(r);if(r&&"object"===e(r)&&"function"==typeof r.getTime)return new Intl.DateTimeFormat(a,s({type:"DATETIME"})).format(r);throw new TypeError("Unknown formatter")},x=function e(){t(this,e)},S=function(e){var t=e.key,n=e.body,r=e.type,i=e.messageStyle,a=K({messageStyle:void 0===i?"richNested":i})({body:n},t);if(!a)throw new Error("Key value not found for ".concat(r," key: (").concat(t,")"));return a.value},D=function(e){function n(e){var r;return t(this,n),(r=l(this,u(n).call(this))).locals=e,r}return s(n,x),r(n,[{key:"getSubstitution",value:function(e){return S({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),n=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in n;return n=n[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),n}(),j=function(e){function n(e){var r;return t(this,n),(r=l(this,u(n).call(this))).substitutions=e,r}return s(n,x),r(n,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),n}(),E=function(n){function i(e,n){var r,a=n.substitutions;return t(this,i),(r=l(this,u(i).call(this))).switches=e,r.substitutions=a,r}return s(i,x),r(i,[{key:"getSubstitution",value:function(t,n){var r,i,a=n.locale,s=n.usedKeys,u=n.arg,c=n.missingSuppliedFormatters,l=this.constructor.getKey(t).slice(1),p=f(this.getMatch(l),3),h=p[0],v=p[1],g=p[2];if(s.push(g),h&&h.includes("|")){var b=f(h.split("|"),3);r=b[1],i=b[2]}if(!v)return c({key:t,formatter:this}),"\\{"+t+"}";var d=function(e,t){var n=y(i);return new Intl.NumberFormat(a,o({},t,{},n)).format(e)},m=function(e,t){var n=y(i);return new Intl.PluralRules(a,o({},t,{},n)).select(e)},w=this.substitutions[g],F=w;if("number"==typeof w)switch(r){case"NUMBER":F=d(w);break;case"PLURAL":F=m(w);break;default:F=new Intl.PluralRules(a).select(w)}else if(w&&"object"===e(w)){var x=Object.keys(w)[0];if(["number","plural"].includes(x)){var D=k({object:w[x]}),j=D.value,E=D.options;if(r||(r=x.toUpperCase()),!(x.toUpperCase()===r))throw new TypeError('Expecting type "'.concat(r.toLowerCase(),'"; instead found "').concat(x,'".'));switch(r){case"NUMBER":F=d(j,E);break;case"PLURAL":F=m(j,E)}}}var O=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return S({messageStyle:"richNested",key:F?O(F):u,body:v,type:"switch"})}catch(e){try{return S({messageStyle:"richNested",key:"*"+O(F),body:v,type:"switch"})}catch(e){var _=Object.keys(v).find((function(e){return e.startsWith("*")}));if(!_)throw new Error("No defaults found for switch ".concat(l));return S({messageStyle:"richNested",key:O(_),body:v,type:"switch"})}}}},{key:"isMatch",value:function(e){return e&&this.constructor.isMatchingKey(e)&&this.getMatch(e.slice(1)).length}},{key:"getMatch",value:function(e){var t=this,n=e.split(".");return n.reduce((function(r,i,a){if(a<n.length-1){if(!(i in r))throw new Error('Switch key "'.concat(i,'" not found (from ').concat(e,")"));return r[i]}var o=Object.entries(r).find((function(e){var n=f(e,1)[0];return i===t.constructor.getKey(n)}));return o?o.concat(i):[]}),this.switches)}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:[\0-\{\}-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/);return t&&t[0]}}]),i}();function O(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function _(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function M(e,t,n){if(!e.s){if(n instanceof T){if(!n.s)return void(n.o=M.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(M.bind(null,e,t),M.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var T=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var a=1&i?t:n;if(a){try{M(r,1,a(this.v))}catch(e){M(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?M(r,1,t?t(i):i):n?M(r,1,n(i)):M(r,2,i)}catch(e){M(r,2,e)}},r},e}();function A(e){return e instanceof T&&1&e.s}function P(e,t,n){for(var r;;){var i=e();if(A(i)&&(i=i.v),!i)return a;if(i.then){r=0;break}var a=n();if(a&&a.then){if(!A(a)){r=1;break}a=a.s}if(t){var o=t();if(o&&o.then&&!A(o)){r=2;break}}}var s=new T,u=M.bind(null,s,2);return(0===r?i.then(l):1===r?a.then(c):o.then(f)).then(void 0,u),s;function c(r){a=r;do{if(t&&(o=t())&&o.then&&!A(o))return void o.then(f).then(void 0,u);if(!(i=e())||A(i)&&!i.v)return void M(s,1,a);if(i.then)return void i.then(l).then(void 0,u);A(a=n())&&(a=a.v)}while(!a||!a.then);a.then(c).then(void 0,u)}function l(e){e?(a=n())&&a.then?a.then(c).then(void 0,u):c(a):M(s,1,a)}function f(){(i=e())?i.then?i.then(l).then(void 0,u):l(i):M(s,1,a)}}function N(e,t){return e&&e.then?e.then(t):t(e)}function L(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var C=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return L((function(){var r,i,a=!1,o=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return N(P((function(){return!a}),void 0,(function(){var s=e.shift();return _((function(){return O(o,(function(e){r=e,a=!0}))}),(function(){if(i)throw new Error(n);e.length||(i=!0),o=t(s)}))})),(function(e){return r}))}))()},I=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},R=function(t){var n=t.string,r=t.dom,i=t.usedKeys,a=t.substitutions,s=t.allSubstitutions,u=t.locale,c=t.locals,l=t.switches,f=t.maximumLocalNestingDepth,h=void 0===f?3:f,v=t.missingSuppliedFormatters,d=t.checkExtraSuppliedFormatters;if("number"!=typeof h)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var m=new D(c),w=new j(a),k=new E(l,{substitutions:a}),x=/(\\*)\{((?:(?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\\\})*?)(?:(\|)((?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*))?\}/g;s&&(s=Array.isArray(s)?s:[s]);var S=function(e){var t,n=e.key,r=e.arg,a=e.substs;return m.constructor.isMatchingKey(n)?t=m.getSubstitution(n):k.constructor.isMatchingKey(n)?t=k.getSubstitution(n,{locale:u,usedKeys:i,arg:r,missingSuppliedFormatters:v}):"function"==typeof(t=a[n])&&(t=t({arg:r,key:n})),s?t=s.reduce((function(e,t){return t({value:e,arg:r,key:n,locale:u})}),t):r&&r.match(/^(?:NUMBER|DATE(?:TIME)?|RELATIVE|LIST)(?:\||$)/)&&(t=F({value:t,arg:r,key:n,locale:u})),t},O=1,_=function(e){var t=e.substitution,n=e.ky,r=e.arg,i=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(O++>h)throw new TypeError("Too much recursion in local variables.");if(m.constructor.isMatchingKey(n)){var s,u=a;r&&(s=y(r),u=o({},a,{},s)),t=i({str:t,substs:u,formatter:m}),s&&d({substitutions:s})}else k.constructor.isMatchingKey(n)&&(t=i({str:t}))}return t};if(!r){var M=!1,T=function t(n){var r=n.str,o=n.substs,s=void 0===o?a:o,u=n.formatter,c=void 0===u?w:u;return r.replace(x,(function(n,r,a,o,u){if(r.length%2)return n;if(v({key:a,formatter:c}))return n;var l=S({key:a,arg:u,substs:s});return l=_({substitution:l,ky:a,arg:u,processSubsts:t}),M=M||l&&"object"===e(l)&&"nodeType"in l,i.push(a),r+l}))}({str:n});if(!M)return d({substitutions:a}),i.length=0,g(T);i.length=0}O=1;var A=function t(n){var r=n.str,o=n.substs,s=void 0===o?a:o,u=n.formatter,c=void 0===u?w:u,l=[],f=new RegExp(x,"gu"),h=function(){l.push.apply(l,arguments)};return b(f,r,{extra:h,onMatch:function(n,r,a,o,u){if(v({key:a,formatter:c}))h(n);else{r.length&&h(r);var l=S({key:a,arg:u,substs:s});l=_({substitution:l,ky:a,arg:u,processSubsts:t}),Array.isArray(l)?h.apply(void 0,p(l)):l&&"object"===e(l)&&"nodeType"in l?h(l.cloneNode(!0)):h(l)}i.push(a)}}),l}({str:n});return d({substitutions:a}),i.length=0,A.map((function(e){return"string"==typeof e?g(e):e}))},K=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.messageStyle,r=void 0===n?"richNested":n;return"function"==typeof r?r:"richNested"===r?function(t,n){var r=t&&"object"===e(t)&&t.body,i=[],a=function(e){i.length||(i[0]=""),i[i.length-1]+=e};b(/(\\*)\./g,n,{extra:a,onMatch:function(e,t){a(t),i.push("")}});var o=i.map((function(e){return g(e)})),s=!1,u=r;return o.some((function(t,n,r){return!u||"object"!==e(u)||(n===r.length-1&&t in u&&u[t]&&"object"===e(u[t])&&"message"in u[t]&&"string"==typeof u[t].message&&(s={value:u[t].message,info:u[t]}),u=u[t],!1)})),s}:"rich"===r?function(t,n){var r=t&&"object"===e(t)&&t.body;return!!(r&&"object"===e(r)&&n in r&&r[n]&&"object"===e(r[n])&&"message"in r[n]&&"string"==typeof r[n].message)&&{value:r[n].message,info:r[n]}}:"plain"===r?function(t,n){var r=t&&"object"===e(t)&&t.body;return!!(r&&"object"===e(r)&&n in r&&r[n]&&"string"==typeof r[n])&&{value:r[n]}}:function(){throw new TypeError("Unknown `messageStyle` ".concat(r))}()},B=function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.message,i=n.defaults,a=n.messageStyle,o=n.messageForKey,s=void 0===o?K({messageStyle:a}):o,u=n.key;if("string"!=typeof u)throw new TypeError("An options object with a `key` string is expected on `getStringFromMessageAndDefaults`");if("string"==typeof r)t=r;else if(!1===i||null==i)t=!1;else{if(!i||"object"!==e(i))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(t=s({body:i},u))&&(t=t.value)}if(!1===t)throw new Error("Key value not found for key: (".concat(u,")"));return t},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,n=e.locale,r=e.locals,i=e.switches,a=(e.maximumLocalNestingDepth,e.allSubstitutions),o=void 0===a?[F]:a,s=e.insertNodes,u=void 0===s?R:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,h=void 0!==f&&f,v=e.forceNodeReturn,g=void 0!==v&&v,y=e.throwOnMissingSuppliedFormatters,b=void 0===y||y,d=e.throwOnExtraSuppliedFormatters,m=void 0===d||d;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var w=function(e){return g?document.createTextNode(e):e},k=[],x=function(e){var t=e.substitutions;m&&Object.keys(t).forEach((function(e){if(!k.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},S=function(e){var t=e.key,n=e.formatter,r=n.isMatch(t);if(n.constructor.isMatchingKey(t)&&!r){if(b)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!o&&!b)return w(t);l||(l={});var D=u({string:t,dom:h,usedKeys:k,substitutions:l,allSubstitutions:o,locale:n,locals:r,switches:i,missingSuppliedFormatters:S,checkExtraSuppliedFormatters:x});if("string"==typeof D)return w(D);var j=document.createDocumentFragment();return j.append.apply(j,p(D)),j};function U(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function q(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function V(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function z(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:[\0-,\.-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*$/,"")}var W=q((function(){var e=q((function(t){if("string"!=typeof t)throw new TypeError("Non-string locale type");var n=s(c,t);if("string"!=typeof n)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return V((function(){return U(fetch(n),(function(e){if(404===e.status)throw new Error("Trying again");return U(e.json(),(function(e){return{locale:t,strings:e}}))}))}),(function(n){if("SyntaxError"===n.name)throw n;return U(f(t),e)}))})),t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.locales,r=void 0===n?"undefined"==typeof navigator?[]:navigator.languages:n,i=t.defaultLocales,a=void 0===i?["en-US"]:i,o=t.localeResolver,s=void 0===o?I:o,u=t.localesBasePath,c=void 0===u?".":u,l=t.localeMatcher,f=void 0===l?"lookup":l;if("lookup"===f)f=z;else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return C([].concat(p(r),p(a)),e,"No matching locale found!")}));function J(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var Z=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.locales,r=t.defaultLocales,i=t.localeStringFinder,a=void 0===i?W:i,s=t.localesBasePath,u=t.localeResolver,c=t.localeMatcher,l=t.messageStyle,f=t.allSubstitutions,p=t.insertNodes,h=t.defaults,v=t.substitutions,g=t.maximumLocalNestingDepth,y=t.dom,b=void 0!==y&&y,m=t.forceNodeReturn,k=void 0!==m&&m,F=t.throwOnMissingSuppliedFormatters,x=void 0===F||F,S=t.throwOnExtraSuppliedFormatters,D=void 0===S||S;try{return J(a({locales:n,defaultLocales:r,localeResolver:u,localesBasePath:s,localeMatcher:c}),(function(t){var n=t.strings,r=t.locale;if(!n||"object"!==e(n))throw new TypeError("Locale strings must be an object!");var i=K({messageStyle:l}),a=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.allSubstitutions,u=void 0===s?f:s,c=a.defaults,l=void 0===c?h:c,y=a.dom,d=void 0===y?b:y,m=a.forceNodeReturn,w=void 0===m?k:m,F=a.throwOnMissingSuppliedFormatters,S=void 0===F?x:F,j=a.throwOnExtraSuppliedFormatters,E=void 0===j?D:j,O=i(n,e),_=B({message:O&&O.value||!1,defaults:l,messageForKey:i,key:e});return $({string:_,locals:n.head&&n.head.locals,switches:n.head&&n.head.switches,locale:r,maximumLocalNestingDepth:g,allSubstitutions:u,insertNodes:p,substitutions:o({},v,{},t),dom:d,forceNodeReturn:w,throwOnMissingSuppliedFormatters:S,throwOnExtraSuppliedFormatters:E})};return a.resolvedLocale=r,a.strings=n,a.sort=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,[r].concat(t))},a.sortList=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w.apply(void 0,[r].concat(t))},a}))}catch(e){return Promise.reject(e)}};export{x as Formatter,D as LocalFormatter,j as RegularFormatter,E as SwitchFormatter,F as defaultAllSubstitutions,R as defaultInsertNodes,z as defaultLocaleMatcher,I as defaultLocaleResolver,W as findLocaleStrings,$ as getDOMForLocaleString,K as getMessageForKeyByStyle,B as getStringFromMessageAndDefaults,Z as i18n,y as parseJSONExtra,b as processRegex,C as promiseChainForValues,g as unescapeBackslashes};
//# sourceMappingURL=index.esm.min.js.map
