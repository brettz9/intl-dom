!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).IntlDom={})}(this,(function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(){o=function(e,t){return new r(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function r(e,n,o){var i=new RegExp(e,n);return t.set(i,o||t.get(e)),f(i,r.prototype)}function n(e,r){var n=t.get(r);return Object.keys(n).reduce((function(t,r){var o=n[r];if("number"==typeof o)t[r]=e[o];else{for(var i=0;void 0===e[o[i]]&&i+1<o.length;)i++;t[r]=e[o[i]]}return t}),Object.create(null))}return c(r,RegExp),r.prototype.exec=function(t){var r=e.exec.call(this,t);if(r){r.groups=n(r,this);var o=r.indices;o&&(o.groups=n(o,this))}return r},r.prototype[Symbol.replace]=function(r,o){if("string"==typeof o){var i=t.get(this);return e[Symbol.replace].call(this,r,o.replace(/\$<([^>]+)>/g,(function(e,t){var r=i[t];return"$"+(Array.isArray(r)?r.join("$"):r)})))}if("function"==typeof o){var a=this;return e[Symbol.replace].call(this,r,(function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(n(e,a)),o.apply(this,e)}))}return e[Symbol.replace].call(this,r,o)},o.apply(this,arguments)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],u=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var b=globalThis.jsonExtra,w=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},S=function(e){return b.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},E=function(e,t,r){var n,o=r.onMatch,i=r.extra,a=r.betweenMatches,s=r.afterMatch,u=r.escapeAtOne,c=0;for(i&&(a=i,s=i,u=i);null!==(n=e.exec(t));){var l=h(n,2),f=l[0],p=l[1],y=e.lastIndex,d=y-f.length;d>c&&a(t.slice(c,d)),u&&p.length%2?(c=y,u(f)):(o.apply(void 0,v(n)),c=y)}c!==t.length&&s(t.slice(c))},x="undefined"!=typeof fetch?fetch:null,j=function(){return x},k="undefined"!=typeof document?document:null,O=function(){return k};var M=function(e,t,r){return t.sort(new Intl.Collator(e,r).compare)},R=function(e,t,r){return new Intl.ListFormat(e,r).format(t)},T=function(e,t,r,n,o){if("function"!=typeof r)return function(e,t,r,n){return M(e,t,n),R(e,t,r)}(e,t,r,n);M(e,t,o);var i,a=(i=Date.now(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(i+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=Math.trunc((i+16*Math.random())%16);return i=Math.floor(i/16),("x"===e?t:3&t|8).toString(16)}))),s=v(t).map((function(e,t){return"<<".concat(a).concat(t,">>")})),u=[],c=function(){u.push.apply(u,arguments)};E(new RegExp("<<".concat(a,"(\\d)>>"),"gu"),R(e,s,n),{betweenMatches:c,afterMatch:c,onMatch:function(e,n){c(r(t[n],n))}});var l=O().createDocumentFragment();return l.append.apply(l,u),l},A=function(e){var t=e.object;if(Array.isArray(t)){if("function"==typeof t[1]){var r=h(t,4);return{value:r[0],callback:r[1],options:r[2],extraOpts:r[3]}}var n=h(t,3);return{value:n[0],options:n[1],extraOpts:n[2]}}return{value:t}},L=function(e){var t,o=e.value,i=e.arg;e.key;var a,s=e.locale;if("string"==typeof o||o&&"object"===n(o)&&"nodeType"in o)return o;var u=function(e){var t=e.type,n=e.options,o=void 0===n?a:n,s=e.checkArgOptions,u=void 0!==s&&s;if("string"==typeof i){var c=h(i.split("|"),3),l=c[0],f=c[1],p=c[2];"DATE"===l&&(l="DATETIME"),l===t&&(f?u&&!p||(o=r(r({},o),S(u&&p?p:f))):o={})}return o},c=!1;if(o&&"object"===n(o)&&!Array.isArray(o)){var l=Object.keys(o)[0];if(["number","date","datetime","dateRange","datetimeRange","relative","region","language","script","currency","list","plural"].includes(l)){var f,p,y=A({object:o[l]});switch(o=y.value,a=y.options,f=y.extraOpts,p=y.callback,l){case"date":case"datetime":c=!0;break;case"dateRange":case"datetimeRange":return(t=new Intl.DateTimeFormat(s,u({type:"DATERANGE",options:f}))).formatRange.apply(t,v([o,a].map((function(e){return"number"==typeof e?new Date(e):e}))));case"region":case"language":case"script":case"currency":return new Intl.DisplayNames(s,r(r({},u({type:l.toUpperCase()})),{},{type:l})).of(o);case"relative":var d=[a,f];return f=d[0],a=d[1],new Intl.RelativeTimeFormat(s,u({type:"RELATIVE"})).format(o,f);case"list":return p?T(s,o,p,u({type:"LIST"}),u({type:"LIST",options:f,checkArgOptions:!0})):T(s,o,u({type:"LIST"}),u({type:"LIST",options:f,checkArgOptions:!0}))}}}if(o&&("number"==typeof o&&(c||/^DATE(?:TIME)(?:\||$)/.test(i))&&(o=new Date(o)),"object"===n(o)&&"function"==typeof o.getTime))return new Intl.DateTimeFormat(s,u({type:"DATETIME"})).format(o);if(Array.isArray(o)){var g,m=o[2];return(g=new Intl.DateTimeFormat(s,u({type:"DATERANGE",options:m}))).formatRange.apply(g,v(o.slice(0,2).map((function(e){return"number"==typeof e?new Date(e):e}))))}if("number"==typeof o)return new Intl.NumberFormat(s,u({type:"NUMBER"})).format(o);throw new TypeError("Unknown formatter")},N=s((function e(){i(this,e)})),F=function(e){var t=e.key,r=e.body,n=e.type,o=e.messageStyle,i=Y({messageStyle:void 0===o?"richNested":o})({body:r},t);if(!i)throw new Error("Key value not found for ".concat(n," key: (").concat(t,")"));return i.value},P=function(e){c(r,e);var t=y(r);function r(e){var n;return i(this,r),(n=t.call(this)).locals=e,n}return s(r,[{key:"getSubstitution",value:function(e){return F({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),r=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in r;return r=r[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),r}(N),D=function(e){c(r,e);var t=y(r);function r(e){var n;return i(this,r),(n=t.call(this)).substitutions=e,n}return s(r,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),r}(N),I=function(e){c(o,e);var t=y(o);function o(e,r){var n,a=r.substitutions;return i(this,o),(n=t.call(this)).switches=e,n.substitutions=a,n}return s(o,[{key:"getSubstitution",value:function(e,t){var o,i,a=t.locale,s=t.usedKeys,u=t.arg,c=t.missingSuppliedFormatters,l=this.constructor.getKey(e).slice(1),f=h(this.getMatch(l),3),p=f[0],y=f[1],v=f[2];if(s.push(v),p&&p.includes("|")){var d=h(p.split("|"),3);o=d[1],i=d[2]}if(!y)return c({key:e,formatter:this}),"\\{"+e+"}";var g=function(e,t){var n=S(i);return new Intl.NumberFormat(a,r(r({},t),n)).format(e)},m=function(e,t){var n=S(i);return new Intl.PluralRules(a,r(r({},t),n)).select(e)},b=this.substitutions[v],w=b;if("number"==typeof b)switch(o){case"NUMBER":w=g(b);break;case"PLURAL":w=m(b);break;default:w=new Intl.PluralRules(a).select(b)}else if(b&&"object"===n(b)){var E=Object.keys(b)[0];if(["number","plural"].includes(E)){var x=A({object:b[E]}),j=x.value,k=x.options;if(o||(o=E.toUpperCase()),!(E.toUpperCase()===o))throw new TypeError('Expecting type "'.concat(o.toLowerCase(),'"; instead found "').concat(E,'".'));switch(o){case"NUMBER":w=g(j,k);break;case"PLURAL":w=m(j,k)}}}var O="richNested",M=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return F({messageStyle:O,key:w?M(w):u,body:y,type:"switch"})}catch(e){try{return F({messageStyle:O,key:"*"+M(w),body:y,type:"switch"})}catch(e){var R=Object.keys(y).find((function(e){return e.startsWith("*")}));if(!R)throw new Error("No defaults found for switch ".concat(l));return F({messageStyle:O,key:M(R),body:y,type:"switch"})}}}},{key:"isMatch",value:function(e){return e&&this.constructor.isMatchingKey(e)&&Boolean(this.getMatch(e.slice(1)).length)}},{key:"getMatch",value:function(e){var t=this,r=e.split(".");return r.reduce((function(n,o,i){if(i<r.length-1){if(!(o in n))throw new Error('Switch key "'.concat(o,'" not found (from "~').concat(e,'")'));return n[o]}var a=Object.entries(n).find((function(e){var r=h(e,1)[0];return o===t.constructor.getKey(r)}));return a?[].concat(v(a),[o]):[]}),this.switches)}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:(?!\|)[\s\S])*/);return t&&t[0]}}]),o}(N);function K(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function C(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function B(e,t,r){if(!e.s){if(r instanceof U){if(!r.s)return void(r.o=B.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(B.bind(null,e,t),B.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var U=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{B(n,1,i(this.v))}catch(e){B(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?B(n,1,t?t(o):o):r?B(n,1,r(o)):B(n,2,o)}catch(e){B(n,2,e)}},n},e}();function $(e){return e instanceof U&&1&e.s}function _(e,t,r){for(var n;;){var o=e();if($(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!$(i)){n=1;break}i=i.s}if(t){var a=t();if(a&&a.then&&!$(a)){n=2;break}}}var s=new U,u=B.bind(null,s,2);return(0===n?o.then(l):1===n?i.then(c):a.then(f)).then(void 0,u),s;function c(n){i=n;do{if(t&&(a=t())&&a.then&&!$(a))return void a.then(f).then(void 0,u);if(!(o=e())||$(o)&&!o.v)return void B(s,1,i);if(o.then)return void o.then(l).then(void 0,u);$(i=r())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,u)}function l(e){e?(i=r())&&i.then?i.then(c).then(void 0,u):c(i):B(s,1,i)}function f(){(o=e())?o.then?o.then(l).then(void 0,u):l(o):B(s,1,i)}}function G(e,t){return e&&e.then?e.then(t):t(e)}function V(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var W=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return V((function(){var n,o,i=!1,a=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return G(_((function(){return!i}),void 0,(function(){var s=e.shift();return C((function(){return K(a,(function(e){n=e,i=!0}))}),(function(){if(o)throw new Error(r);e.length||(o=!0),a=t(s)}))})),(function(e){return n}))}))()},J=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");if(/[\.\/\\]/.test(t))throw new TypeError("Locales cannot use file-reserved characters, `.`, `/` or `\\`");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},z=function(e){var t=e.string,o=e.dom,i=e.usedKeys,a=e.substitutions,s=e.allSubstitutions,u=e.locale,c=e.locals,l=e.switches,f=e.maximumLocalNestingDepth,p=void 0===f?3:f,y=e.missingSuppliedFormatters,d=e.checkExtraSuppliedFormatters;if("number"!=typeof p)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var g=function(){Object.entries(a).forEach((function(e){var t=h(e,2),r=t[0];"function"==typeof t[1]&&i.push(r)}))};g();var m=new P(c),b=new D(a),x=new I(l,{substitutions:a}),j=/(\\*)\{((?:(?:(?!\})[\s\S])|\\\})*?)(?:(\|)((?:(?!\})[\s\S])*))?\}/g;s&&(s=Array.isArray(s)?s:[s]);var k=function(e){var t,r=e.key,n=e.arg,o=e.substs;return m.constructor.isMatchingKey(r)?t=m.getSubstitution(r):x.constructor.isMatchingKey(r)?t=x.getSubstitution(r,{locale:u,usedKeys:i,arg:n,missingSuppliedFormatters:y}):"function"==typeof(t=o[r])&&(t=t({arg:n,key:r})),s?t=s.reduce((function(e,t){return t({value:e,arg:n,key:r,locale:u})}),t):n&&/^(?:NUMBER|DATE(?:TIME|RANGE|TIMERANGE)?|REGION|LANGUAGE|SCRIPT|CURRENCY|RELATIVE|LIST)(?:\||$)/.test(n)&&(t=L({value:t,arg:n,key:r,locale:u})),t},O=1,M=function(e){var t=e.substitution,n=e.ky,o=e.arg,i=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(O++>p)throw new TypeError("Too much recursion in local variables.");if(m.constructor.isMatchingKey(n)){var s,u=a;o&&(s=S(o),u=r(r({},a),s)),t=i({str:t,substs:u,formatter:m}),s&&d({substitutions:s})}else x.constructor.isMatchingKey(n)&&(t=i({str:t}))}return t};if(!o){var R=!1,T=function e(t){var r=t.str,o=t.substs,s=void 0===o?a:o,u=t.formatter,c=void 0===u?b:u;return r.replace(j,(function(t,r,o,a,u){if(r.length%2)return t;if(y({key:o,formatter:c}))return t;var l=k({key:o,arg:u,substs:s});return l=M({substitution:l,ky:o,arg:u,processSubsts:e}),R=R||l&&"object"===n(l)&&"nodeType"in l,i.push(o),r+l}))}({str:t});if(!R)return d({substitutions:a}),i.length=0,g(),w(T);i.length=0,g()}O=1;var A=function e(t){var r=t.str,o=t.substs,s=void 0===o?a:o,u=t.formatter,c=void 0===u?b:u,l=[],f=new RegExp(j,"gu"),p=function(){l.push.apply(l,arguments)};return E(f,r,{extra:p,onMatch:function(t,r,o,a,u){if(y({key:o,formatter:c}))p(t);else{r.length&&p(r);var l=k({key:o,arg:u,substs:s});l=M({substitution:l,ky:o,arg:u,processSubsts:e}),Array.isArray(l)?p.apply(void 0,v(l)):l&&"object"===n(l)&&"nodeType"in l?p(l.cloneNode(!0)):p(l)}i.push(o)}}),l}({str:t});return d({substitutions:a}),i.length=0,A.map((function(e){return"string"==typeof e?w(e):e}))};function H(e,t){if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&"string"==typeof t&&t.endsWith("Nested"))return e.map((function(e){return e.replace(o(/(\\+)/g,{backslashes:1}),"\\$<backslashes>").replace(/\./g,"\\.")})).join(".");if("string"!=typeof e)throw new TypeError("`key` is expected to be a string (or array of strings for nested style)");return e}var Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.messageStyle,r=void 0===t?"richNested":t;return"function"==typeof r?r:"richNested"===r?function(e,t){var r=e&&"object"===n(e)&&e.body,o=[],i=function(e){o.length||(o[0]=""),o[o.length-1]+=e};E(/(\\*)\./g,t,{extra:i,onMatch:function(e,t){i(t),o.push("")}});var a=o.map((function(e){return w(e)})),s=!1,u=r;return a.some((function(e,t,r){return!u||"object"!==n(u)||(t===r.length-1&&e in u&&u[e]&&"object"===n(u[e])&&"message"in u[e]&&"string"==typeof u[e].message&&(s={value:u[e].message,info:u[e]}),u=u[e],!1)})),s}:"rich"===r?function(e,t){var r=e&&"object"===n(e)&&e.body;return!!(r&&"object"===n(r)&&t in r&&r[t]&&"object"===n(r[t])&&"message"in r[t]&&"string"==typeof r[t].message)&&{value:r[t].message,info:r[t]}}:"plain"===r?function(e,t){var r=e&&"object"===n(e)&&e.body;return!!(r&&"object"===n(r)&&t in r&&r[t]&&"string"==typeof r[t])&&{value:r[t]}}:"plainNested"===r?function(e,t){var r=e&&"object"===n(e)&&e.body;if(r&&"object"===n(r)){var o=t.split(/(?<!\\)\./).reduce((function(e,t){return e&&e[t]?e[t]:null}),r);if(o&&"string"==typeof o)return{value:o}}return!1}:function(){throw new TypeError("Unknown `messageStyle` ".concat(r))}()},Z=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.message,o=t.defaults,i=t.messageStyle,a=t.messageForKey,s=void 0===a?Y({messageStyle:i}):a,u=t.key;if("string"==typeof r)e=r;else if(!1===o||null==o)e=!1;else{if(!o||"object"!==n(o))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(e=s(o,u))&&(e=e.value)}if(!1===e)throw new Error("Key value not found for key: (".concat(u,")"));return e},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,r=e.locale,n=e.locals,o=e.switches;e.maximumLocalNestingDepth;var i=e.allSubstitutions,a=void 0===i?[L]:i,s=e.insertNodes,u=void 0===s?z:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,p=void 0!==f&&f,y=e.forceNodeReturn,h=void 0!==y&&y,d=e.throwOnMissingSuppliedFormatters,g=void 0===d||d,m=e.throwOnExtraSuppliedFormatters,b=void 0===m||m;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var w=function(e){var t=O();return h?t.createTextNode(e):e},S=[],E=function(e){var t=e.substitutions;b&&Object.keys(t).forEach((function(e){if(!S.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},x=function(e){var t=e.key,r=e.formatter,n=r.isMatch(t);if(r.constructor.isMatchingKey(t)&&!n){if(g)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!a&&!g)return w(t);l||(l={});var j=u({string:t,dom:p,usedKeys:S,substitutions:l,allSubstitutions:a,locale:r,locals:n,switches:o,missingSuppliedFormatters:x,checkExtraSuppliedFormatters:E});if("string"==typeof j)return w(j);var k=O(),M=k.createDocumentFragment();return M.append.apply(M,v(j)),M};function Q(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function X(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var ee=function(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:(?!\x2D)[\s\S])*$/,"")},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,o=e.localesBasePath,i=e.localeMatcher;return re({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:o,localeMatcher:i})},re=X((function(e){var t=X((function(e){if("string"!=typeof e)throw new TypeError("Non-string locale type");var r=s(c,e);if("string"!=typeof r)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}((function(){var t=j();return Q(y?t(r,{method:"HEAD"}):t(r),(function(t){if(404===t.status)throw new Error("Trying again");return y?e:Q(t.json(),(function(t){return{locale:e,strings:t}}))}))}),(function(r){if("SyntaxError"===r.name)throw r;return Q(f(e),t)}))})),r=e.locales,n=void 0===r?"undefined"!=typeof intlDomLocale?[intlDomLocale]:"undefined"==typeof navigator?[]:navigator.languages:r,o=e.defaultLocales,i=void 0===o?["en-US"]:o,a=e.localeResolver,s=void 0===a?J:a,u=e.localesBasePath,c=void 0===u?".":u,l=e.localeMatcher,f=void 0===l?"lookup":l,p=e.headOnly,y=void 0!==p&&p;if("lookup"===f)f=ee;else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return W([].concat(v(n),v(i)),t,"No matching locale found for "+[].concat(v(n),v(i)).join(", "))}));function ne(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function oe(e,t){var r=e();return r&&r.then?r.then(t):t(r)}var ie=function(e){var t=e.strings,o=e.resolvedLocale,i=e.messageStyle,a=void 0===i?"richNested":i,s=e.allSubstitutions,u=e.insertNodes,c=e.keyCheckerConverter,l=void 0===c?H:c,f=e.defaults,p=e.substitutions,y=e.maximumLocalNestingDepth,h=e.dom,v=void 0!==h&&h,d=e.forceNodeReturn,g=void 0!==d&&d,m=e.throwOnMissingSuppliedFormatters,b=void 0===m||m,w=e.throwOnExtraSuppliedFormatters,S=void 0===w||w;if(!t||"object"!==n(t))throw new TypeError("Locale strings must be an object!");var E=Y({messageStyle:a}),x=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=i.allSubstitutions,h=void 0===c?s:c,d=i.defaults,m=void 0===d?f:d,w=i.dom,x=void 0===w?v:w,j=i.forceNodeReturn,k=void 0===j?g:j,O=i.throwOnMissingSuppliedFormatters,M=void 0===O?b:O,R=i.throwOnExtraSuppliedFormatters,T=void 0===R?S:R;e=l(e,a);var A=E(t,e),L=Z({message:!(!A||"string"!=typeof A.value)&&A.value,defaults:m,messageForKey:E,key:e});return q({string:L,locals:t.head&&t.head.locals,switches:t.head&&t.head.switches,locale:o,maximumLocalNestingDepth:y,allSubstitutions:h,insertNodes:u,substitutions:r(r({},p),n),dom:x,forceNodeReturn:k,throwOnMissingSuppliedFormatters:M,throwOnExtraSuppliedFormatters:T})};return x.resolvedLocale=o,x.strings=t,x.sort=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return M.apply(void 0,[o].concat(t))},x.sortList=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return T.apply(void 0,[o].concat(t))},x.list=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return R.apply(void 0,[o].concat(t))},x};e.Formatter=N,e.LocalFormatter=P,e.RegularFormatter=D,e.SwitchFormatter=I,e.defaultAllSubstitutions=L,e.defaultInsertNodes=z,e.defaultKeyCheckerConverter=H,e.defaultLocaleMatcher=ee,e.defaultLocaleResolver=J,e.findLocale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeResolver,o=e.localesBasePath,i=e.localeMatcher;return re({locales:t,defaultLocales:r,localeResolver:n,localesBasePath:o,localeMatcher:i,headOnly:!0})},e.findLocaleStrings=te,e.getDOMForLocaleString=q,e.getDocument=O,e.getFetch=j,e.getMatchingLocale=function(e){var t=e.locale,r=e.locales,n=e.localeResolver,o=void 0===n?ee:n;try{for(;!r.includes(t);)t=o(t)}catch(e){return!1}return t},e.getMessageForKeyByStyle=Y,e.getStringFromMessageAndDefaults=Z,e.i18n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,r=e.defaultLocales,n=e.localeStringFinder,o=void 0===n?te:n,i=e.localesBasePath,a=e.localeResolver,s=e.localeMatcher,u=e.messageStyle,c=e.allSubstitutions,l=e.insertNodes,f=e.keyCheckerConverter,p=e.defaults,y=e.substitutions,h=e.maximumLocalNestingDepth,v=e.dom,d=e.forceNodeReturn,g=e.throwOnMissingSuppliedFormatters,m=e.throwOnExtraSuppliedFormatters;try{return ne(o({locales:t,defaultLocales:r,localeResolver:a,localesBasePath:i,localeMatcher:s}),(function(e){var t=e.strings,n=e.locale;return oe((function(){if(!p&&r)return ne(o({locales:r,defaultLocales:[],localeResolver:a,localesBasePath:i,localeMatcher:s}),(function(e){p=e.strings,e.locale===n&&(p=null)}))}),(function(){return ie({strings:t,resolvedLocale:n,messageStyle:u,allSubstitutions:c,insertNodes:l,keyCheckerConverter:f,defaults:p,substitutions:y,maximumLocalNestingDepth:h,dom:v,forceNodeReturn:d,throwOnMissingSuppliedFormatters:g,throwOnExtraSuppliedFormatters:m})}))}))}catch(e){return Promise.reject(e)}},e.i18nServer=ie,e.parseJSONExtra=S,e.processRegex=E,e.promiseChainForValues=W,e.setDocument=function(e){k=e},e.setFetch=function(e){x=e},e.setJSONExtra=function(e){b=e},e.unescapeBackslashes=w}));
//# sourceMappingURL=index.umd.min.js.map
