!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).IntlDom={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f(this,n)}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){const n=[];function r(){return n.pop()||{context:0,elements:null,element_array:null}}function o(e){n.push(e)}const a=[];function i(e){a.push(e)}const s=t;s.escape=function(e){let t="";if(!e)return e;for(let n=0;n<e.length;n++)'"'!=e[n]&&"\\"!=e[n]&&"`"!=e[n]&&"'"!=e[n]||(t+="\\"),t+=e[n];return t},s.begin=function(e,t){const n={name:null,value_type:0,string:"",contains:null},s={line:1,col:1};let u=0,c=0,l=!0,f=!1,p=null,h=void 0,y=[],v=0,d=0,g=!1,m=!1,b=!1,w=!1,k=!1,F=null,x=!1,S=!1,D=!1,E=!1,j=!1,O=!1,M=!1,_=0,T=0,A=!1;const L={first:null,last:null,saved:null,push(e){let t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last||(this.first=t),this.last=t},pop(){const e=this.last;return(this.last=e.prior)||(this.first=null),e.next=this.saved,this.saved=e,e.node}},N={first:null,last:null,saved:null,push(e){let t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t},shift(){const e=this.first;return e?(this.first=e.next,this.first||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){const t=this.saved;this.saved=t.next,t.node=e,t.next=this.first,t.prior=null,this.first||(this.last=t),this.first=t}};function P(e){throw new Error(`${e} at ${u} [${s.line}:${s.col}]`)}return{finalError(){if(0!==d)switch(d){case 1:return P("Comment began at end of document");case 2:console.log("Warning: '//' comment without end of line ended document");break;case 3:return P("Open comment '/*' is missing close at end of document");case 4:return P("Incomplete '/* *' close at end of document")}x&&P("Incomplete string")},value(){this.finalError();const e=p;return p=void 0,e},reset(){c=0,l=!0,N.last&&(N.last.next=N.save),N.save=N.first,N.first=N.last=null,L.last&&(L.last.next=L.save),L.save=N.first,L.first=L.last=null,y=null,h=void 0,v=0,n.value_type=0,n.name=null,n.string="",s.line=1,s.col=1,f=!1,d=0,A=!1,x=!1,D=!1,E=!1},write(n){let r;for(void 0!==n&&"string"!=typeof n&&(n=String(n)),r=this._write(n,!1);r>0&&(this.finalError(),"function"==typeof t&&function e(n,r){const o=n[r];if(o&&"object"==typeof o)for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){const n=e(o,t);void 0!==n?o[t]=n:delete o[t]}return t.call(n,r,o)}({"":p},""),e(p),p=void 0,!(r<2));r=this._write());r&&this.finalError()},_write(e,t){let P,R,I=0;function B(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${u} (near '${R.substr(u>4?u-4:0,u>4?3:u-1)}[${String.fromCodePoint(t)}]${R.substr(u,10)}') [${s.line}:${s.col}]`)}function C(){n.value_type=0,n.string=""}function K(){switch(n.value_type){case 5:y.push((f?-1:1)*Number(n.string));break;case 4:y.push(n.string);break;case 2:y.push(!0);break;case 3:y.push(!1);break;case 8:case 9:y.push(NaN);break;case 10:y.push(-1/0);break;case 11:y.push(1/0);break;case 1:y.push(null);break;case-1:y.push(void 0);break;case 13:y.push(void 0),delete y[y.length-1];break;case 6:case 7:y.push(n.contains)}}function $(){switch(n.value_type){case 5:h[n.name]=(f?-1:1)*Number(n.string);break;case 4:h[n.name]=n.string;break;case 2:h[n.name]=!0;break;case 3:h[n.name]=!1;break;case 8:case 9:h[n.name]=NaN;break;case 10:h[n.name]=-1/0;break;case 11:h[n.name]=1/0;break;case 1:h[n.name]=null;break;case-1:h[n.name]=void 0;break;case 6:case 7:h[n.name]=n.contains}}function U(e){let t=0;for(;0==t&&u<R.length;){let r=R.charAt(u);const o=R.codePointAt(u++);if(o>=65536&&(r+=R.charAt(u),u++),s.col++,o==e)D?(M?B("Incomplete hexidecimal sequence",o):j?B("Incomplete long unicode sequence",o):O&&B("Incomplete unicode sequence",o),E?(E=!1,t=1):n.string+=r,D=!1):t=1;else if(D){if(j){if(125==o){n.string+=String.fromCodePoint(_),j=!1,O=!1,D=!1;continue}_*=16,o>=48&&o<=57?_+=o-48:o>=65&&o<=70?_+=o-65+10:o>=97&&o<=102?_+=o-97+10:B("(escaped character, parsing hex of \\u)",o);continue}if(M||O){if(0===T&&123===o){j=!0;continue}_*=16,o>=48&&o<=57?_+=o-48:o>=65&&o<=70?_+=o-65+10:o>=97&&o<=102?_+=o-97+10:B(O?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",o),T++,O?4==T&&(n.string+=String.fromCodePoint(_),O=!1,D=!1):2==T&&(n.string+=String.fromCodePoint(_),M=!1,D=!1);continue}switch(o){case 13:E=!0,s.col=1;continue;case 8232:case 8233:s.col=1;case 10:E?E=!1:s.col=1,s.line++;break;case 116:n.string+="\t";break;case 98:n.string+="\b";break;case 48:n.string+="\0";break;case 110:n.string+="\n";break;case 114:n.string+="\r";break;case 102:n.string+="\f";break;case 120:M=!0,T=0,_=0;continue;case 117:O=!0,T=0,_=0;continue;default:n.string+=r}D=!1}else 92===o?D=!0:(E&&(E=!1,s.line++,s.col=2),n.string+=r)}return t}function V(){let e;for(;(e=u)<R.length;){const r=R.charAt(e),o=R.codePointAt(u++);if(o>=65536&&B("fault while parsing number;",o),95!=o)if(s.col++,o>=48&&o<=57)b&&(k=!0),n.string+=r;else if(45==o||43==o)0==n.string.length||b&&!w&&!k?(n.string+=r,w=!0):(l=!1,B("fault while parsing number;",o));else if(46==o)m||g||b?(l=!1,B("fault while parsing number;",o)):(n.string+=r,m=!0);else if(120==o||98==o||111==o||88==o||66==o||79==o)g||"0"!=n.string?(l=!1,B("fault while parsing number;",o)):(g=!0,n.string+=r);else{if(101!=o&&69!=o){if(32==o||160==o||13==o||10==o||9==o||65279==o||44==o||125==o||93==o||58==o)break;t&&(l=!1,B("fault while parsing number;",o));break}b?(l=!1,B("fault while parsing number;",o)):(n.string+=r,b=!0)}}u=e,t||u!=R.length?(S=!1,n.value_type=5,0==v&&(A=!0)):S=!0}if(!l)return-1;if(e&&e.length)P=function(){let e=a.pop();return e?e.n=0:e={buf:null,n:0},e}(),P.buf=e,N.push(P);else if(S){if(S=!1,n.value_type=5,0!=v)throw new Error("context stack is not empty at flush");A=!0,I=1}for(;l&&(P=N.shift());){if(u=P.n,R=P.buf,x){U(F)>0&&(x=!1,n.value_type=4)}for(S&&V();!A&&l&&u<R.length;){let e=R.charAt(u);const t=R.codePointAt(u++);if(t>=65536&&(e+=R.charAt(u),u++),s.col++,d)1==d?42==t?d=3:47!=t?B("fault while parsing;",t):d=2:2==d?10!=t&&13!=t||(d=0):3==d?42==t&&(d=4):d=47==t?0:3;else{switch(t){case 47:d=1;break;case 123:(29==c||30==c||3==v&&0==c)&&B("fault while parsing; getting field name unexpected ",t);{const e=r();n.value_type=6;const t={};0==v&&(p=h=t),e.context=v,e.elements=h,e.element_array=y,e.name=n.name,h=t,L.push(e),C(),v=3}break;case 91:if(3!=v&&29!=c&&30!=c||B("Fault while parsing; while getting field name unexpected",t),0==n.value_type||-1==n.value_type){const e=r();n.value_type=7;const t=[];0==v?p=y=t:4==v&&(h[n.name]=t),e.context=v,e.elements=h,e.element_array=y,e.name=n.name,y=t,L.push(e),C(),v=1}else B("Unexpected array open after previous value",t);break;case 58:3==v?(c=0,n.name=n.string,n.string="",v=4,n.value_type=0):B(1==v?"(in array, got colon out of string):parsing fault;":"(outside any object, got colon out of string):parsing fault;",t);break;case 125:if(31==c&&(c=0),3==v){n.value_type=6,n.contains=h;const e=L.pop();n.name=e.name,v=e.context,h=e.elements,y=e.element_array,o(e),0==v&&(A=!0)}else if(4==v){0!=n.value_type?$():B("Fault while parsing field value, close with no value",t),n.value_type=6,n.contains=h;const e=L.pop();n.name=e.name,v=e.context,h=e.elements,y=e.element_array,o(e),0==v&&(A=!0)}else B("Fault while parsing; unexpected",t);f=!1;break;case 93:if(31==c&&(c=0),1==v){0!=n.value_type&&K(),n.value_type=7,n.contains=y;{const e=L.pop();n.name=e.name,v=e.context,h=e.elements,y=e.element_array,o(e)}0==v&&(A=!0)}else B(`bad context ${v}; fault while parsing`,t);f=!1;break;case 44:31==c&&(c=0),1==v?(0==n.value_type&&(n.value_type=13),K(),C()):4==v?(v=3,0!=n.value_type?($(),C()):B("Unexpected comma after object field name",t)):(l=!1,B("bad context; excessive commas while parsing;",t)),f=!1;break;default:if(3==v)switch(t){case 96:case 34:case 39:if(0==c){0!=n.value_type&&B("String begin after previous value",t);U(t)?n.value_type=4:(F=t,x=!0)}else B("fault while parsing; quote not at start of field name",t);break;case 10:s.line++,s.col=1;case 13:case 32:case 160:case 9:case 65279:31==c?c=0:29==c&&(c=30);break;default:30==c&&(l=!1,B("fault while parsing; character unexpected",t)),0==c&&(c=29),n.string+=e}else switch(t){case 96:case 34:case 39:if(0===n.value_type){U(t)?(n.value_type=4,c=31):(F=t,x=!0)}else B("String unexpected",t);break;case 10:s.line++,s.col=1;case 32:case 160:case 9:case 13:case 65279:if(31==c){c=0,0==v&&(A=!0);break}0!==c&&(l=!1,B("fault parsing whitespace",t));break;case 116:0==c?c=1:27==c?c=28:(l=!1,B("fault parsing",t));break;case 114:1==c?c=2:(l=!1,B("fault parsing",t));break;case 117:2==c?c=3:9==c?c=10:0==c?c=12:(l=!1,B("fault parsing",t));break;case 101:3==c?(n.value_type=2,c=31):8==c?(n.value_type=3,c=31):14==c?c=15:18==c?c=19:(l=!1,B("fault parsing",t));break;case 110:0==c?c=9:12==c?c=13:17==c?c=18:22==c?c=23:25==c?c=26:(l=!1,B("fault parsing",t));break;case 100:13==c?c=14:19==c?(n.value_type=-1,c=31):(l=!1,B("fault parsing",t));break;case 105:16==c?c=17:24==c?c=25:26==c?c=27:(l=!1,B("fault parsing",t));break;case 108:10==c?c=11:11==c?(n.value_type=1,c=31):6==c?c=7:(l=!1,B("fault parsing",t));break;case 102:0==c?c=5:15==c?c=16:23==c?c=24:(l=!1,B("fault parsing",t));break;case 97:5==c?c=6:20==c?c=21:(l=!1,B("fault parsing",t));break;case 115:7==c?c=8:(l=!1,B("fault parsing",t));break;case 73:0==c?c=22:(l=!1,B("fault parsing",t));break;case 78:0==c?c=20:21==c?(n.value_type=f?8:9,f=!1,c=31):(l=!1,B("fault parsing",t));break;case 121:28==c?(n.value_type=f?10:11,f=!1,c=31):(l=!1,B("fault parsing",t));break;case 45:0==c?f=!f:(l=!1,B("fault parsing",t));break;default:t>=48&&t<=57||43==t||46==t||45==t?(g=!1,b=!1,w=!1,k=!1,m=!1,n.string=e,P.n=u,V()):(l=!1,B("fault parsing",t))}}if(A){31==c&&(c=0);break}}}if(u==R.length?(i(P),x||S||3==v?I=0:0!=v||0==n.value_type&&!p||(A=!0,I=1)):(P.n=u,N.unshift(P),I=2),A)break}if(A&&0!=n.value_type){switch(n.value_type){case 5:p=(f?-1:1)*Number(n.string);break;case 4:p=n.string;break;case 2:p=!0;break;case 3:p=!1;break;case 1:p=null;break;case-1:p=void 0;break;case 9:case 8:p=NaN;break;case 11:p=1/0;break;case 10:p=-1/0;break;case 6:case 7:p=n.contains}f=!1,n.string="",n.value_type=0}return A=!1,I}}};const u=[Object.freeze(s.begin())];let c=0;s.parse=function(e,t){const n=c++;u.length<=n&&u.push(Object.freeze(s.begin()));const r=u[n];if("string"!=typeof e&&(e=String(e)),r.reset(),r._write(e,!0)>0){const e=r.value();return"function"==typeof t&&function e(n,r){const o=n[r];if(o&&"object"==typeof o)for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){const n=e(o,t);void 0!==n?o[t]=n:delete o[t]}return t.call(n,r,o)}({"":e},""),c--,e}r.finalError()},s.stringify=JSON.stringify})),m=function(e){return e.replace(/\\+/g,(function(e){return e.slice(0,e.length/2)}))},b=function(e){return g.parse("{"+(e||"").replace(/^\{/,"").replace(/\}$/,"")+"}")},w=function(e,t,n){var r,o=n.onMatch,a=n.extra,i=n.betweenMatches,s=n.afterMatch,u=n.escapeAtOne,c=0;for(a&&(i=a,s=a,u=a);null!==(r=e.exec(t));){var l=h(r,2),f=l[0],p=l[1],v=e.lastIndex,d=v-f.length;d>c&&i(t.slice(c,d)),u&&p.length%2?(c=v,u(f)):(o.apply(void 0,y(r)),c=v)}c!==t.length&&s(t.slice(c))},k="undefined"!=typeof fetch?fetch:null,F=function(){return k},x="undefined"!=typeof document?document:null,S=function(){return x};var D=function(e,t,n){return t.sort(new Intl.Collator(e,n).compare)},E=function(e,t,n){return new Intl.ListFormat(e,n).format(t)},j=function(e,t,n,r,o){if("function"!=typeof n)return function(e,t,n,r){return D(e,t,r),E(e,t,n)}(e,t,n,r);D(e,t,o);var a,i=(a=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(a+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===e?t:3&t|8).toString(16)}))),s=y(t).map((function(e,t){return"<<".concat(i).concat(t,">>")})),u=[],c=function(){u.push.apply(u,arguments)};w(new RegExp("<<".concat(i,"(\\d)>>"),"gu"),E(e,s,r),{betweenMatches:c,afterMatch:c,onMatch:function(e,r){c(n(t[r],r))}});var l=S().createDocumentFragment();return l.append.apply(l,u),l},O=function(e){var t=e.object;if(Array.isArray(t)){if("function"==typeof t[1]){var n=h(t,4);return{value:n[0],callback:n[1],options:n[2],extraOpts:n[3]}}var r=h(t,3);return{value:r[0],options:r[1],extraOpts:r[2]}}return{value:t}},M=function(e){var n,r=e.value,o=e.arg,a=(e.key,e.locale);if("string"==typeof r||r&&"object"===t(r)&&"nodeType"in r)return r;var i=function(e){var t=e.type,r=e.options,a=void 0===r?n:r,i=e.checkArgOptions,u=void 0!==i&&i;if("string"==typeof o){var c=h(o.split("|"),3),l=c[0],f=c[1],p=c[2];"DATE"===l&&(l="DATETIME"),l===t&&(f?u&&!p||(a=s(s({},a),b(u&&p?p:f))):a={})}return a};if(r&&"object"===t(r)){var u=Object.keys(r)[0];if(["number","date","datetime","relative","list","plural"].includes(u)){var c,l,f=O({object:r[u]});switch(r=f.value,n=f.options,c=f.extraOpts,l=f.callback,u){case"relative":var p=[n,c];return c=p[0],n=p[1],new Intl.RelativeTimeFormat(a,i({type:"RELATIVE"})).format(r,c);case"list":return l?j(a,r,l,i({type:"LIST"}),i({type:"LIST",options:c,checkArgOptions:!0})):j(a,r,i({type:"LIST"}),i({type:"LIST",options:c,checkArgOptions:!0}))}}}if("number"==typeof r)return new Intl.NumberFormat(a,i({type:"NUMBER"})).format(r);if(r&&"object"===t(r)&&"function"==typeof r.getTime)return new Intl.DateTimeFormat(a,i({type:"DATETIME"})).format(r);throw new TypeError("Unknown formatter")},_=function e(){n(this,e)},T=function(e){var t=e.key,n=e.body,r=e.type,o=e.messageStyle,a=z({messageStyle:void 0===o?"richNested":o})({body:n},t);if(!a)throw new Error("Key value not found for ".concat(r," key: (").concat(t,")"));return a.value},A=function(e){u(r,e);var t=p(r);function r(e){var o;return n(this,r),(o=t.call(this)).locals=e,o}return o(r,[{key:"getSubstitution",value:function(e){return T({key:e.slice(1),body:this.locals,type:"local"})}},{key:"isMatch",value:function(e){var t=e.slice(1).split("."),n=this.locals;return this.constructor.isMatchingKey(e)&&t.every((function(e){var t=e in n;return n=n[e],t}))}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("-")}}]),r}(_),L=function(e){u(r,e);var t=p(r);function r(e){var o;return n(this,r),(o=t.call(this)).substitutions=e,o}return o(r,[{key:"isMatch",value:function(e){return this.constructor.isMatchingKey(e)&&e in this.substitutions}}],[{key:"isMatchingKey",value:function(e){return/^[0-9A-Z_a-z]/.test(e)}}]),r}(_),N=function(e){u(a,e);var r=p(a);function a(e,t){var o,i=t.substitutions;return n(this,a),(o=r.call(this)).switches=e,o.substitutions=i,o}return o(a,[{key:"getSubstitution",value:function(e,n){var r,o,a=n.locale,i=n.usedKeys,u=n.arg,c=n.missingSuppliedFormatters,l=this.constructor.getKey(e).slice(1),f=h(this.getMatch(l),3),p=f[0],y=f[1],v=f[2];if(i.push(v),p&&p.includes("|")){var d=h(p.split("|"),3);r=d[1],o=d[2]}if(!y)return c({key:e,formatter:this}),"\\{"+e+"}";var g=function(e,t){var n=b(o);return new Intl.NumberFormat(a,s(s({},t),n)).format(e)},m=function(e,t){var n=b(o);return new Intl.PluralRules(a,s(s({},t),n)).select(e)},w=this.substitutions[v],k=w;if("number"==typeof w)switch(r){case"NUMBER":k=g(w);break;case"PLURAL":k=m(w);break;default:k=new Intl.PluralRules(a).select(w)}else if(w&&"object"===t(w)){var F=Object.keys(w)[0];if(["number","plural"].includes(F)){var x=O({object:w[F]}),S=x.value,D=x.options;if(r||(r=F.toUpperCase()),!(F.toUpperCase()===r))throw new TypeError('Expecting type "'.concat(r.toLowerCase(),'"; instead found "').concat(F,'".'));switch(r){case"NUMBER":k=g(S,D);break;case"PLURAL":k=m(S,D)}}}var E=function(e){return e.replace(/\\/g,"\\\\").replace(/\./g,"\\.")};try{return T({messageStyle:"richNested",key:k?E(k):u,body:y,type:"switch"})}catch(e){try{return T({messageStyle:"richNested",key:"*"+E(k),body:y,type:"switch"})}catch(e){var j=Object.keys(y).find((function(e){return e.startsWith("*")}));if(!j)throw new Error("No defaults found for switch ".concat(l));return T({messageStyle:"richNested",key:E(j),body:y,type:"switch"})}}}},{key:"isMatch",value:function(e){return e&&this.constructor.isMatchingKey(e)&&Boolean(this.getMatch(e.slice(1)).length)}},{key:"getMatch",value:function(e){var t=this,n=e.split(".");return n.reduce((function(r,o,a){if(a<n.length-1){if(!(o in r))throw new Error('Switch key "'.concat(o,'" not found (from "~').concat(e,'")'));return r[o]}var i=Object.entries(r).find((function(e){var n=h(e,1)[0];return o===t.constructor.getKey(n)}));return i?i.concat(o):[]}),this.switches)}}],[{key:"isMatchingKey",value:function(e){return e.startsWith("~")}},{key:"getKey",value:function(e){var t=e.match(/^(?:[\0-\{\}-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/);return t&&t[0]}}]),a}(_);function P(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function R(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function I(e,t,n){if(!e.s){if(n instanceof B){if(!n.s)return void(n.o=I.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(I.bind(null,e,t),I.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var B=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var a=1&o?t:n;if(a){try{I(r,1,a(this.v))}catch(e){I(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?I(r,1,t?t(o):o):n?I(r,1,n(o)):I(r,2,o)}catch(e){I(r,2,e)}},r},e}();function C(e){return e instanceof B&&1&e.s}function K(e,t,n){for(var r;;){var o=e();if(C(o)&&(o=o.v),!o)return a;if(o.then){r=0;break}var a=n();if(a&&a.then){if(!C(a)){r=1;break}a=a.s}if(t){var i=t();if(i&&i.then&&!C(i)){r=2;break}}}var s=new B,u=I.bind(null,s,2);return(0===r?o.then(l):1===r?a.then(c):i.then(f)).then(void 0,u),s;function c(r){a=r;do{if(t&&(i=t())&&i.then&&!C(i))return void i.then(f).then(void 0,u);if(!(o=e())||C(o)&&!o.v)return void I(s,1,a);if(o.then)return void o.then(l).then(void 0,u);C(a=n())&&(a=a.v)}while(!a||!a.then);a.then(c).then(void 0,u)}function l(e){e?(a=n())&&a.then?a.then(c).then(void 0,u):c(a):I(s,1,a)}function f(){(o=e())?o.then?o.then(l).then(void 0,u):l(o):I(s,1,a)}}function $(e,t){return e&&e.then?e.then(t):t(e)}function U(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var V=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Reached end of values array.";if(!Array.isArray(e))throw new TypeError("The `values` argument to `promiseChainForValues` must be an array.");if("function"!=typeof t)throw new TypeError("The `errBack` argument to `promiseChainForValues` must be a function.");return U((function(){var r,o,a=!1,i=Promise.reject(new Error("Intentionally reject so as to begin checking chain"));return $(K((function(){return!a}),void 0,(function(){var s=e.shift();return R((function(){return P(i,(function(e){r=e,a=!0}))}),(function(){if(o)throw new Error(n);e.length||(o=!0),i=t(s)}))})),(function(e){return r}))}))()},q=function(e,t){if("string"!=typeof e)throw new TypeError("`defaultLocaleResolver` expects a string `localesBasePath`.");if("string"!=typeof t)throw new TypeError("`defaultLocaleResolver` expects a string `locale`.");if(/[\.\/\\]/.test(t))throw new TypeError("Locales cannot use file-reserved characters, `.`, `/` or `\\`");return"".concat(e.replace(/\/$/,""),"/_locales/").concat(t,"/messages.json")},W=function(e){var n=e.string,r=e.dom,o=e.usedKeys,a=e.substitutions,i=e.allSubstitutions,u=e.locale,c=e.locals,l=e.switches,f=e.maximumLocalNestingDepth,p=void 0===f?3:f,h=e.missingSuppliedFormatters,v=e.checkExtraSuppliedFormatters;if("number"!=typeof p)throw new TypeError("`maximumLocalNestingDepth` must be a number.");var d=new A(c),g=new L(a),k=new N(l,{substitutions:a}),F=/(\\*)\{((?:(?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\\\})*?)(?:(\|)((?:[\0-\|~-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*))?\}/g;i&&(i=Array.isArray(i)?i:[i]);var x=function(e){var t,n=e.key,r=e.arg,a=e.substs;return d.constructor.isMatchingKey(n)?t=d.getSubstitution(n):k.constructor.isMatchingKey(n)?t=k.getSubstitution(n,{locale:u,usedKeys:o,arg:r,missingSuppliedFormatters:h}):"function"==typeof(t=a[n])&&(t=t({arg:r,key:n})),i?t=i.reduce((function(e,t){return t({value:e,arg:r,key:n,locale:u})}),t):r&&r.match(/^(?:NUMBER|DATE(?:TIME)?|RELATIVE|LIST)(?:\||$)/)&&(t=M({value:t,arg:r,key:n,locale:u})),t},S=1,D=function(e){var t=e.substitution,n=e.ky,r=e.arg,o=e.processSubsts;if("string"==typeof t&&t.includes("{")){if(S++>p)throw new TypeError("Too much recursion in local variables.");if(d.constructor.isMatchingKey(n)){var i,u=a;r&&(i=b(r),u=s(s({},a),i)),t=o({str:t,substs:u,formatter:d}),i&&v({substitutions:i})}else k.constructor.isMatchingKey(n)&&(t=o({str:t}))}return t};if(!r){var E=!1,j=function e(n){var r=n.str,i=n.substs,s=void 0===i?a:i,u=n.formatter,c=void 0===u?g:u;return r.replace(F,(function(n,r,a,i,u){if(r.length%2)return n;if(h({key:a,formatter:c}))return n;var l=x({key:a,arg:u,substs:s});return l=D({substitution:l,ky:a,arg:u,processSubsts:e}),E=E||l&&"object"===t(l)&&"nodeType"in l,o.push(a),r+l}))}({str:n});if(!E)return v({substitutions:a}),o.length=0,m(j);o.length=0}S=1;var O=function e(n){var r=n.str,i=n.substs,s=void 0===i?a:i,u=n.formatter,c=void 0===u?g:u,l=[],f=new RegExp(F,"gu"),p=function(){l.push.apply(l,arguments)};return w(f,r,{extra:p,onMatch:function(n,r,a,i,u){if(h({key:a,formatter:c}))p(n);else{r.length&&p(r);var l=x({key:a,arg:u,substs:s});l=D({substitution:l,ky:a,arg:u,processSubsts:e}),Array.isArray(l)?p.apply(void 0,y(l)):l&&"object"===t(l)&&"nodeType"in l?p(l.cloneNode(!0)):p(l)}o.push(a)}}),l}({str:n});return v({substitutions:a}),o.length=0,O.map((function(e){return"string"==typeof e?m(e):e}))},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.messageStyle,r=void 0===n?"richNested":n;return"function"==typeof r?r:"richNested"===r?function(e,n){var r=e&&"object"===t(e)&&e.body,o=[],a=function(e){o.length||(o[0]=""),o[o.length-1]+=e};w(/(\\*)\./g,n,{extra:a,onMatch:function(e,t){a(t),o.push("")}});var i=o.map((function(e){return m(e)})),s=!1,u=r;return i.some((function(e,n,r){return!u||"object"!==t(u)||(n===r.length-1&&e in u&&u[e]&&"object"===t(u[e])&&"message"in u[e]&&"string"==typeof u[e].message&&(s={value:u[e].message,info:u[e]}),u=u[e],!1)})),s}:"rich"===r?function(e,n){var r=e&&"object"===t(e)&&e.body;return!!(r&&"object"===t(r)&&n in r&&r[n]&&"object"===t(r[n])&&"message"in r[n]&&"string"==typeof r[n].message)&&{value:r[n].message,info:r[n]}}:"plain"===r?function(e,n){var r=e&&"object"===t(e)&&e.body;return!!(r&&"object"===t(r)&&n in r&&r[n]&&"string"==typeof r[n])&&{value:r[n]}}:function(){throw new TypeError("Unknown `messageStyle` ".concat(r))}()},J=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.message,o=n.defaults,a=n.messageStyle,i=n.messageForKey,s=void 0===i?z({messageStyle:a}):i,u=n.key;if("string"!=typeof u)throw new TypeError("An options object with a `key` string is expected on `getStringFromMessageAndDefaults`");if("string"==typeof r)e=r;else if(!1===o||null==o)e=!1;else{if(!o||"object"!==t(o))throw new TypeError("Default locale strings must resolve to `false`, nullish, or an object!");(e=s({body:o},u))&&(e=e.value)}if(!1===e)throw new Error("Key value not found for key: (".concat(u,")"));return e},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.string,n=e.locale,r=e.locals,o=e.switches,a=(e.maximumLocalNestingDepth,e.allSubstitutions),i=void 0===a?[M]:a,s=e.insertNodes,u=void 0===s?W:s,c=e.substitutions,l=void 0!==c&&c,f=e.dom,p=void 0!==f&&f,h=e.forceNodeReturn,v=void 0!==h&&h,d=e.throwOnMissingSuppliedFormatters,g=void 0===d||d,m=e.throwOnExtraSuppliedFormatters,b=void 0===m||m;if("string"!=typeof t)throw new TypeError("An options object with a `string` property set to a string must be provided for `getDOMForLocaleString`.");var w=function(e){var t=S();return v?t.createTextNode(e):e},k=[],F=function(e){var t=e.substitutions;b&&Object.keys(t).forEach((function(e){if(!k.includes(e))throw new Error("Extra formatting key: ".concat(e))}))},x=function(e){var t=e.key,n=e.formatter,r=n.isMatch(t);if(n.constructor.isMatchingKey(t)&&!r){if(g)throw new Error("Missing formatting key: ".concat(t));return!0}return!1};if(!l&&!i&&!g)return w(t);l||(l={});var D=u({string:t,dom:p,usedKeys:k,substitutions:l,allSubstitutions:i,locale:n,locals:r,switches:o,missingSuppliedFormatters:x,checkExtraSuppliedFormatters:F});if("string"==typeof D)return w(D);var E=S(),j=E.createDocumentFragment();return j.append.apply(j,y(D)),j};function Z(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function G(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var Q=function(e){if(!e.includes("-"))throw new Error("Locale not available");return e.replace(/\x2D(?:[\0-,\.-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*$/,"")},X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,n=e.defaultLocales,r=e.localeResolver,o=e.localesBasePath,a=e.localeMatcher;return Y({locales:t,defaultLocales:n,localeResolver:r,localesBasePath:o,localeMatcher:a})},Y=G((function(e){var t=G((function(e){if("string"!=typeof e)throw new TypeError("Non-string locale type");var n=s(c,e);if("string"!=typeof n)throw new TypeError("`localeResolver` expected to resolve to (URL) string.");return function(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}((function(){var t=F();return Z(h?t(n,{method:"HEAD"}):t(n),(function(t){if(404===t.status)throw new Error("Trying again");return h?e:Z(t.json(),(function(t){return{locale:e,strings:t}}))}))}),(function(n){if("SyntaxError"===n.name)throw n;return Z(f(e),t)}))})),n=e.locales,r=void 0===n?"undefined"!=typeof intlDomLocale?[intlDomLocale]:"undefined"==typeof navigator?[]:navigator.languages:n,o=e.defaultLocales,a=void 0===o?["en-US"]:o,i=e.localeResolver,s=void 0===i?q:i,u=e.localesBasePath,c=void 0===u?".":u,l=e.localeMatcher,f=void 0===l?"lookup":l,p=e.headOnly,h=void 0!==p&&p;if("lookup"===f)f=Q;else if("function"!=typeof f)throw new TypeError('`localeMatcher` must be "lookup" or a function!');return V([].concat(y(r),y(a)),t,"No matching locale found!")}));function ee(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}var te=function(e){var n=e.strings,r=e.resolvedLocale,o=e.messageStyle,a=e.allSubstitutions,i=e.insertNodes,u=e.defaults,c=e.substitutions,l=e.maximumLocalNestingDepth,f=e.dom,p=void 0!==f&&f,h=e.forceNodeReturn,y=void 0!==h&&h,v=e.throwOnMissingSuppliedFormatters,d=void 0===v||v,g=e.throwOnExtraSuppliedFormatters,m=void 0===g||g;if(!n||"object"!==t(n))throw new TypeError("Locale strings must be an object!");var b=z({messageStyle:o}),w=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=o.allSubstitutions,h=void 0===f?a:f,v=o.defaults,g=void 0===v?u:v,w=o.dom,k=void 0===w?p:w,F=o.forceNodeReturn,x=void 0===F?y:F,S=o.throwOnMissingSuppliedFormatters,D=void 0===S?d:S,E=o.throwOnExtraSuppliedFormatters,j=void 0===E?m:E,O=b(n,e),M=J({message:O&&O.value||!1,defaults:g,messageForKey:b,key:e});return H({string:M,locals:n.head&&n.head.locals,switches:n.head&&n.head.switches,locale:r,maximumLocalNestingDepth:l,allSubstitutions:h,insertNodes:i,substitutions:s(s({},c),t),dom:k,forceNodeReturn:x,throwOnMissingSuppliedFormatters:D,throwOnExtraSuppliedFormatters:j})};return w.resolvedLocale=r,w.strings=n,w.sort=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return D.apply(void 0,[r].concat(t))},w.sortList=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return j.apply(void 0,[r].concat(t))},w.list=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return E.apply(void 0,[r].concat(t))},w};e.Formatter=_,e.LocalFormatter=A,e.RegularFormatter=L,e.SwitchFormatter=N,e.defaultAllSubstitutions=M,e.defaultInsertNodes=W,e.defaultLocaleMatcher=Q,e.defaultLocaleResolver=q,e.findLocale=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,n=e.defaultLocales,r=e.localeResolver,o=e.localesBasePath,a=e.localeMatcher;return Y({locales:t,defaultLocales:n,localeResolver:r,localesBasePath:o,localeMatcher:a,headOnly:!0})},e.findLocaleStrings=X,e.getDOMForLocaleString=H,e.getDocument=S,e.getFetch=F,e.getMatchingLocale=function(e){var t=e.locale,n=e.locales,r=e.localeResolver,o=void 0===r?Q:r;try{for(;!n.includes(t);)t=o(t)}catch(e){return!1}return t},e.getMessageForKeyByStyle=z,e.getStringFromMessageAndDefaults=J,e.i18n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.locales,n=e.defaultLocales,r=e.localeStringFinder,o=void 0===r?X:r,a=e.localesBasePath,i=e.localeResolver,s=e.localeMatcher,u=e.messageStyle,c=e.allSubstitutions,l=e.insertNodes,f=e.defaults,p=e.substitutions,h=e.maximumLocalNestingDepth,y=e.dom,v=e.forceNodeReturn,d=e.throwOnMissingSuppliedFormatters,g=e.throwOnExtraSuppliedFormatters;try{return ee(o({locales:t,defaultLocales:n,localeResolver:i,localesBasePath:a,localeMatcher:s}),(function(e){var t=e.strings,n=e.locale;return te({strings:t,resolvedLocale:n,messageStyle:u,allSubstitutions:c,insertNodes:l,defaults:f,substitutions:p,maximumLocalNestingDepth:h,dom:y,forceNodeReturn:v,throwOnMissingSuppliedFormatters:d,throwOnExtraSuppliedFormatters:g})}))}catch(e){return Promise.reject(e)}},e.i18nServer=te,e.parseJSONExtra=b,e.processRegex=w,e.promiseChainForValues=V,e.setDocument=function(e){x=e},e.setFetch=function(e){k=e},e.unescapeBackslashes=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
